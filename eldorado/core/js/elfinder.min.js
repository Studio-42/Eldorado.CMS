/**
 * @author Dmitry (dio) Levashov, dio@std42.ru, Programming
 * @author Troex Nevelin, troex@fury.scancode.ru, Techsupport, make file, testing
 * @author Valientin Razumnih, content@std42.ru, Design
 * Copyright: Studio42 LTD, http://www.std42.ru/
 * License: BSD license
 * Documentation: http://www.elrte.ru/doc/ 
 *
**/
function eli18n(a){this.textdomain=function(b){return this.messages[b]?this._domain=b:this._domain};a&&a.messages&&this.load(a.messages);a&&a.textdomain&&this.textdomain(a.textdomain)}eli18n.prototype=new function(){this.messages={};this._domain="";this.load=function(c){if(typeof(c)=="object"){for(var e in c){var b=c[e];if(typeof(b)=="object"){if(!this.messages[e]){this.messages[e]={}}for(var a in b){if(typeof(b[a])=="string"){this.messages[e][a]=b[a]}}}}}return this};this.translate=function(b,a){var a=a&&this.messages[a]?a:this._domain;return this.messages[a]&&this.messages[a][b]?this.messages[a][b]:b};this.format=function(e,b,c){e=this.translate(e,c);if(typeof(b)=="object"){for(var a in b){e=e.replace("%"+a,this.translate(b[a],c))}}return e}};function elcookie(b,k,a){if(typeof k=="undefined"){if(document.cookie&&document.cookie!=""){var l=document.cookie.split(";");var h=b+"=";for(var f=0;f<l.length;f++){var j=$.trim(l[f]);if(j.substring(0,b.length+1)==h){return decodeURIComponent(j.substring(b.length+1))}}}return""}else{a=$.extend({expires:"",path:"",domain:"",secure:false},a);if(k===null){k="";a.expires=-1}var e="";if(a.expires){var g=a.expires.toUTCString?a.expires:new Date();if(typeof a.expires=="number"){g.setTime(g.getTime()+(a.expires*24*60*60*1000))}e="; expires="+g.toUTCString()}document.cookie=b+"="+encodeURIComponent(k)+e+(a.path?"; path="+a.path:"")+(a.domain?"; domain="+a.domain:"")+(a.secure?"; secure":"")}}function elDialogForm(c){var a=this;var b={"class":"el-dialogform",submit:function(f,g){window.console&&window.console.log&&window.console.log("submit called");g.close()},form:{action:window.location.href,method:"post"},ajaxForm:null,validate:null,spinner:"Loading",tabs:{active:0},tabPrefix:"el-df-tab-",dialog:{title:"dialog",autoOpen:false,modal:true,resizable:false,buttons:{Cancel:function(){a.close()},Ok:function(){a.form.trigger("submit")}}}};this.opts=$.extend(true,b,c,{dialog:{autoOpen:false,close:function(){a.close()}}});if(c&&c.dialog&&c.dialog.buttons&&typeof(c.dialog.buttons)=="object"){this.opts.dialog.buttons=c.dialog.buttons}this.ul=null;this.tabs={};this._table=null;this.dialog=$("<div />").addClass(this.opts["class"]).dialog(this.opts.dialog);this.message=$('<div class="el-dialogform-message rounded-5" />').hide().appendTo(this.dialog);this.error=$('<div class="el-dialogform-error rounded-5" />').hide().appendTo(this.dialog);this.spinner=$('<div class="spinner" />').hide().appendTo(this.dialog);this.content=$('<div class="el-dialogform-content" />').appendTo(this.dialog);this.form=$("<form />").attr(this.opts.form).appendTo(this.content);if(this.opts.submit){this.form.bind("submit",function(d){a.opts.submit(d,a)})}if(this.opts.ajaxForm&&$.fn.ajaxForm){this.form.ajaxForm(this.opts.ajaxForm)}if(this.opts.validate){this.form.validate(this.opts.validate)}this.option=function(d,e){return this.dialog.dialog("option",d,e)};this.showError=function(d,e){this.hideMessage();this.hideSpinner();this.error.html(d).show();e&&this.content.hide();return this};this.hideError=function(){this.error.text("").hide();this.content.show();return this};this.showSpinner=function(d){this.error.hide();this.message.hide();this.content.hide();this.spinner.text(d||this.opts.spinner).show();this.option("buttons",{});return this};this.hideSpinner=function(){this.content.show();this.spinner.hide();return this};this.showMessage=function(d,e){this.hideError();this.hideSpinner();this.message.html(d||"").show();e&&this.content.hide();return this};this.hideMessage=function(){this.message.hide();this.content.show();return this};this.tab=function(e,d){e=this.opts.tabPrefix+e;if(!this.ul){this.ul=$("<ul />").prependTo(this.form)}$("<li />").append($("<a />").attr("href","#"+e).html(d)).appendTo(this.ul);this.tabs[e]={tab:$("<div />").attr("id",e).addClass("tab").appendTo(this.form),table:null};return this};this.table=function(d){d=d&&d.indexOf(this.opts.tabPrefix)==-1?this.opts.tabPrefix+d:d;if(d&&this.tabs&&this.tabs[d]){this.tabs[d].table=$("<table />").appendTo(this.tabs[d].tab)}else{this._table=$("<table />").appendTo(this.form)}return this};this.append=function(g,h,e){h=h?"el-df-tab-"+h:"";if(!g){return this}if(h&&this.tabs[h]){if(e){!this.tabs[h].table&&this.table(h);var f=$("<tr />").appendTo(this.tabs[h].table);if(!$.isArray(g)){f.append($("<td />").append(g))}else{for(var d=0;d<g.length;d++){f.append($("<td />").append(g[d]))}}}else{if(!$.isArray(g)){this.tabs[h].tab.append(g)}else{for(var d=0;d<g.length;d++){this.tabs[h].tab.append(g[d])}}}}else{if(!e){if(!$.isArray(g)){this.form.append(g)}else{for(var d=0;d<g.length;d++){this.form.append(g[d])}}}else{if(!this._table){this.table()}var f=$("<tr />").appendTo(this._table);if(!$.isArray(g)){f.append($("<td />").append(g))}else{for(var d=0;d<g.length;d++){f.append($("<td />").append(g[d]))}}}}return this};this.separator=function(d){d="el-df-tab-"+d;if(this.tabs&&this.tabs[d]){this.tabs[d].tab.append($("<div />").addClass("separator"));this.tabs[d].table&&this.table(d)}else{this.form.append($("<div />").addClass("separator"))}return this};this.open=function(){this.ul&&this.form.tabs(this.opts.tabs);this.form.find(":text").keyup(function(d){if(d.keyCode==13){a.form.submit()}});this.dialog.attr("unselectable","on").dialog("open");this.form.find(":text").eq(0).focus();return this};this.close=function(){this.dialog.dialog("destroy").remove()}}(function(a){a.fn.eldirtree=function(c){if(!b){var b=c&&c.constructor==Object?a.extend({},a.fn.eldirtree.defaults,c):a.fn.eldirtree.defaults}return this.each(function(){var e=this;if(!this.loaded){this.loaded=true;var d=a(this).addClass(b.cssClass).find("li").prepend(a("<div />")).filter(":has(ul)").children("div").addClass("el-dir-collapsed").click(function(f){if(a(this).hasClass("el-dir-expanded")){a(this).removeClass("el-dir-expanded").next("a").removeClass("el-dir-expanded").parent("li").children("ul").hide()}else{a(this).addClass("el-dir-expanded").next("a").addClass("el-dir-expanded").parent("li").children("ul").show()}}).end().end().end().children("li").find("a").addClass("el-dir-collapsed rounded-3").end();if(d.length==1){d.children("a, div").addClass("el-dir-expanded").end().find("ul li ul").hide()}else{d.find("ul").hide()}d.find("a").bind("click cd",function(f){f.stopPropagation();f.preventDefault();d.find("a").removeClass("selected");a(this).addClass("selected").parent().parents("li").filter(":has(ul)").children("a, div").addClass("el-dir-expanded").end().children("ul").show();f.type=="click"&&b.callback(a(this))});d.eq(0).children("a").addClass("selected")}})};a.fn.eldirtree.defaults={cssClass:"el-dir-tree",callback:function(){}}})(jQuery);(function(d){var a={};var e=document.createElement("div");d.elcontextmenu=function(f,g,h){g=g||document.body;d(e).hide().addClass("el-contextmenu rounded-5").appendTo(document.body);for(name in f){a[name]=f[name];d(name,g).bind(window.opera?"click":"contextmenu",c)}e.callback=h};function c(g){g.stopPropagation();b();if(window.opera&&!g.ctrlKey){return}else{d(document.body).mousedown(function(h){b()})}for(name in a){if(d.inArray(g.currentTarget,d(name))>-1){if(e.callback){e.callback(g)}variants=a[name];d(variants).each(function(){if(!this.label){d("<div />").addClass("delim").appendTo(e)}else{var h=this.action;d("<div></div>").html(this.label).mousedown(function(i){i.stopPropagation();b();if(typeof(h)=="function"){h(g.currentTarget)}}).hover(function(){d(this).addClass("el-contextmenu-hover")},function(){d(this).removeClass("el-contextmenu-hover")}).appendTo(e)}})}}var f={height:d(window).height(),width:d(window).width(),sT:d(window).scrollTop(),cW:d(e).width(),cH:d(e).height()};d(e).css({left:((g.clientX+f.cW)>f.width?(g.clientX-f.cW):g.clientX),top:((g.clientY+f.cH)>f.height&&g.clientY>f.cH?(g.clientY+f.sT-f.cH):g.clientY+f.sT)}).show();return false}function b(f){d(e).hide().empty()}})(jQuery);(function(a){a.fn.elfinder=function(f){var d={};var c="1.01";var b=["list","ismall","ibig"];if(f&&f.constructor==Object){d=a.extend({},a.fn.elfinder.defaults,f)}if(!d.url){alert("Invalid configuration! Connector URL required!");return}return this.each(function(){var h=this;var l=a(this);var m=l.attr("id");this.tree=null;this.nav=null;this.cwd=null;this.fnum=null;this.fsize=null;this.info={};this.history=[];this.buttons={};this.buffer=[];this._i18n=new eli18n({textdomain:"elfinder",messages:{elfinder:a.fn.elfinder.i18Messages[d.lang]||{}}});this.cookieView="elfinder-view-"+m;this.cookieReports="elfinder-reports-"+m;this.i18n=function(n){return h._i18n.translate(n)};var g=elcookie(this.cookieView);this.view=g&&a.inArray(g,b)?g:"list";var k=elcookie(this.cookieReports);this.showReports=k?(k>0?1:0):1;var i={".dir-r":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(n){h._open(a(n))}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(n){h.copy()}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(n){h.getInfo(a(n))}}],".dir-rw":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(n){h._open(a(n))}},{label:'<span class="icon icon-rename"></span>'+this.i18n("Rename"),action:function(n){h.rename(a(n))}},{label:'<span class="icon icon-rm"></span>'+this.i18n("Delete"),action:function(n){h.rm()}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(n){h.copy()}},{label:'<span class="icon icon-cut"></span>'+this.i18n("Cut"),action:function(n){h.copy(true)}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(n){h.getInfo(a(n))}}],".file-r":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(n){h._open(a(n))}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(n){h.copy()}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(n){h.getInfo(a(n))}}],".file-rw":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(n){h._open(a(n))}},{label:'<span class="icon icon-rename"></span>'+this.i18n("Rename"),action:function(n){h.rename(a(n))}},{label:'<span class="icon icon-rm"></span>'+this.i18n("Delete"),action:function(n){h.rm()}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(n){h.copy()}},{label:'<span class="icon icon-cut"></span>'+this.i18n("Cut"),action:function(n){h.copy(true)}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(n){h.getInfo(a(n))}}],".image-r":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(n){h._open(a(n))}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(n){h.copy()}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(n){h.getInfo(a(n))}}],".image-rw":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(n){h._open(a(n))}},{label:'<span class="icon icon-rename"></span>'+this.i18n("Rename"),action:function(n){h.rename(a(n))}},{label:'<span class="icon icon-rm"></span>'+this.i18n("Delete"),action:function(n){h.rm()}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(n){h.copy()}},{label:'<span class="icon icon-cut"></span>'+this.i18n("Cut"),action:function(n){h.copy(true)}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(n){h.getInfo(a(n))}}],".el-finder-cwd":[]};if(d.editorCallback){var j={label:'<span class="icon icon-select"></span>'+this.i18n("Select file"),action:function(n){h.selectFile(a(n))}};i[".file-r"].unshift(j);i[".file-rw"].unshift(j);i[".image-r"].unshift(j);i[".image-rw"].unshift(j)}if(!this.loaded){if(!this.options){this.options=d;if(this.options.dialog){a.extend(this.options.dialog,{close:function(){h.loaded=false;l.dialog("destroy")}})}}a.ajax({url:this.options.url,cache:false,data:{view:this.view},error:function(o,n,p){alert(n+" "+p)},success:function(n){h.init(n)}})}if(f=="open"){this.open()}else{if(f=="close"){this.close()}}this.open=function(){if(this.options.dialog){l.dialog("open")}else{l.show()}};this.close=function(){if(this.options.dialog){this.loaded=false;l.dialog("close")}else{l.hide()}};this.init=function(o){l.empty().html(o);if(!l.children(".el-finder").length){return l.empty().html(this.i18n("Invalid backend configuration"))}this.loaded=true;var n=l.find("ul.el-finder-toolbar");this.buttons={back:n.children(".button-back").click(function(){!a(this).hasClass("disabled")&&h.back()}),reload:n.children(".button-reload").bind("click",h.reload),select:n.children(".button-select").click(function(){!a(this).hasClass("disabled")&&h.selectFile(h._selected(true))}),open:n.children(".button-open").click(function(){!a(this).hasClass("disabled")&&h._open(h._selected(true))}),edit:n.children(".button-edit").click(function(){!a(this).hasClass("disabled")&&h.edit(h._selected(true))}),rename:n.children(".button-rename").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.rename(h._selected(true))}),rm:n.children(".button-rm").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.rm()}),info:n.children(".button-info").click(function(){!a(this).hasClass("disabled")&&h.getInfo(h._selected(true))}),mkdir:n.children(".button-mkdir").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.mkdir()}),upload:n.children(".button-upload").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.upload()}),copy:n.children(".button-copy").click(function(){!a(this).hasClass("disabled")&&h.copy()}),cut:n.children(".button-cut").click(function(){!a(this).hasClass("disabled")&&h.copy(h.info.write)}),paste:n.children(".button-paste").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.paste()}),ibig:n.children(".button-ibig").click(function(){!a(this).hasClass("disabled")&&h.swithchView("ibig")}),ismall:n.children(".button-ismall").click(function(){!a(this).hasClass("disabled")&&h.swithchView("ismall")}),list:n.children(".button-list").click(function(){!a(this).hasClass("disabled")&&h.swithchView("list")}),reports:n.children(".button-reports").bind("click",h.switchReports),help:n.children(".button-help").bind("click",h.help)};if(!this.options.editorCallback){this.buttons.select.hide()}if(!this.options.editTextFiles){this.buttons.edit.hide()}this.fnum=l.find(".files-num");this.fsize=l.find(".files-size");this.cwd=l.find(".el-finder-cwd").click(function(p){if(p.target==this){h.cwd.find(".selected").removeClass("selected");h.updateToolbar()}}).bind("update",function(){h.info=h.cwd.children().eq(0).metadata();a(this).find(".item").bind("dblclick",function(q){q.stopPropagation();var p=a(this);if(!p.hasClass("disabled")){h._open(a(this))}}).bind("click",function(v){var u=a(this);var r=u.hasClass("selected");if(!v.ctrlKey&&!v.metaKey&&!v.shiftKey){h.cwd.find(".selected").removeClass("selected")}else{if(v.shiftKey){var t=u.prevAll(".selected").get(0);var q=u.nextAll(".selected").get(0);var p=false;if(t){u.prevAll(".item").each(function(){if(this==t){p=true;a(this).addClass("selected")}else{if(!p){a(this).addClass("selected")}else{a(this).removeClass("selected")}}});u.nextAll(".selected").removeClass("selected")}else{if(q){u.nextAll(".item").each(function(){if(this==q){p=true;a(this).addClass("selected")}else{if(!p){a(this).addClass("selected")}else{a(this).removeClass("selected")}}});u.prevAll(".selected").removeClass("selected")}}}}if(!r){u.addClass("selected")}else{u.removeClass("selected")}h.updateToolbar()});if(!h.info.write){i[".el-finder-cwd"]=[{label:'<span class="icon icon-reload"></span>'+h.i18n("Reload"),action:function(p){h.reload()}}]}else{i[".el-finder-cwd"]=[{label:'<span class="icon icon-reload"></span>'+h.i18n("Reload"),action:function(p){h.reload()}},{},{label:'<span class="icon icon-paste"></span>'+h.i18n("Paste"),action:function(p){h.paste()}},{},{label:'<span class="icon icon-mkdir"></span>'+h.i18n("Create directory"),action:function(p){h.mkdir()}},{label:'<span class="icon icon-upload"></span>'+h.i18n("Upload files"),action:function(p){h.upload()}}]}a.elcontextmenu(i,h,function(p){if(window.opera&&!p.ctrlKey){return}if(!a(p.currentTarget).hasClass("el-finder-cwd")){a(p.currentTarget).addClass("selected")}});h.updateToolbar();h._unlock();h.fnum.text(h.info.filesNum);h.fsize.text(h.info.filesSize)});this.nav=l.find(".el-finder-nav").bind("update",function(){h.tree=l.find(".el-dir-tree").eldirtree({callback:h.cd});h.tree.find('[key="'+h.info.key+'"]').trigger("cd");h._unlock()});if(this.options.height){this.cwd.css("height",this.options.height+"px");this.nav.css("height",this.options.height+"px")}this.cwd.trigger("update");this.nav.trigger("update");if(this.options.dialog){l.dialog(this.options.dialog).parent().find(".ui-dialog-content").css("padding","0")}a(document).bind("keydown",function(p){if(p.keyCode==46||(p.metaKey&&p.keyCode==8)){h.rm()}else{if(p.ctrlKey||p.metaKey){if(p.keyCode==67){h.copy()}else{if(p.keyCode==88){h.copy(true)}else{if(p.keyCode==86){h.paste()}}}}}})};this.updateToolbar=function(){if(h.history.length){h.buttons.back.removeClass("disabled")}else{h.buttons.back.addClass("disabled")}var p=this._selected();if(this.options.editorCallback){if(p&&p.length==1&&!p.eq(0).hasClass("dir-r")&&!p.eq(0).hasClass("dir-rw")){h.buttons.select.removeClass("disabled")}else{h.buttons.select.addClass("disabled")}}if(this.options.editTextFiles){if(p&&p.length==1&&p.eq(0).attr("class").match(/text/)){h.buttons.edit.removeClass("disabled")}else{h.buttons.edit.addClass("disabled")}}if(p){h.buttons.open.removeClass("disabled");h.buttons.info.removeClass("disabled");h.buttons.copy.removeClass("disabled");if(h.info.write){h.buttons.rename.removeClass("disabled");h.buttons.rm.removeClass("disabled");h.buttons.cut.removeClass("disabled")}}else{h.buttons.open.addClass("disabled");h.buttons.info.addClass("disabled");h.buttons.rename.addClass("disabled");h.buttons.copy.addClass("disabled");h.buttons.rm.addClass("disabled");h.buttons.cut.addClass("disabled")}if(h.buffer.length){h.buttons.paste.removeClass("disabled")}else{h.buttons.paste.addClass("disabled")}if(h.info.write){h.buttons.mkdir.removeClass("disabled");h.buttons.upload.removeClass("disabled")}else{h.buttons.rename.addClass("disabled");h.buttons.mkdir.addClass("disabled");h.buttons.upload.addClass("disabled");h.buttons.paste.addClass("disabled")}for(var o=0;o<b.length;o++){var n=b[o];if(n==h.view){h.buttons[n].addClass("disabled")}else{h.buttons[n].removeClass("disabled")}}if(h.showReports>0){h.buttons.reports.removeClass("disabled")}else{h.buttons.reports.addClass("disabled")}};this._open=function(n){if(n){if(n.hasClass("dir-r")||n.hasClass("dir-rw")){this.cd(n)}else{window.open(d.url+"?cmd=open&current="+this.info.key+"&target="+n.attr("key"),null,"top=50,left=50,scrollbars=yes,resizable=yes")}}};this.cd=function(p){h._lock();h.history.push(h.info.key);var n=typeof(p)=="object"?p.attr("key"):p;a.ajax({url:d.url,cache:false,data:{cmd:"cd",target:n,view:h.view},error:function(q,o,s){h._showError(o+" "+s);h._unlock()},success:function(o){h.cwd.empty().html(o).trigger("update");h.nav.trigger("update")}})};this.reload=function(){h.cd(h.info.key);a.ajax({url:d.url,data:{cmd:"tree",target:h.info.key},error:function(o,n,p){h._showError(n+" "+p);h._unlock()},success:function(n){h.nav.html(n).trigger("update")}})};this.back=function(){if(!this.buttons.back.hasClass("disabled")&&this.history.length){this.cd(this.history.pop());this.history.pop()}};this.selectFile=function(n){if(d.editorCallback){a.ajax({url:d.url,dataType:"json",data:{cmd:"url",current:h.info.key,target:a(n).attr("key")},error:function(p,o,q){h._showError(o+" "+q)},success:function(o){d.editorCallback(o.url);if(h.options.dialog){h.close()}}})}};this.getInfo=function(n){if(n){h._lock();a.ajax({url:d.url,data:{cmd:"info",current:h.info.key,target:n.attr("key")},error:function(p,o,q){h._showError(o+" "+q);h._unlock()},success:function(o){var p=new elDialogForm({dialog:{title:h.i18n("File info"),buttons:{Ok:function(){p.close()}}}});p.append(o).open();h._unlock()}})}};this.copy=function(o){this.buffer=[];var n=this._selected();if(n){this.buffer=[this.info.key,[],!!(this.info.write&&o)];a.each(n,function(){h.buffer[1].push(a(this).attr("key"))})}this.updateToolbar()};this.paste=function(){if(this.buffer.length){h._lock();a.ajax({url:d.url,dataType:"json",data:{cmd:"copy",current:h.info.key,source:h.buffer[0],"files[]":h.buffer[1],move:h.buffer[2]},error:function(o,n,p){h._showError(n+" "+p);h._unlock()},success:function(n){h._unlock();if(n.error){h._showError(n.error);h.buffer=[];h.updateToolbar()}else{if(h.showReports){h._showMessage(n.message)}else{h.reload()}}}})}};this.rename=function(t){if(t){var n=t.find(".basename").eq(0);var r=n.text();var u=n.attr("title");var q=a('<input type="text" />').val(u).keyup(function(o){if(o.keyCode==27){s()}else{if(o.keyCode==13){p()}}}).bind("change blur",function(){p()}).click(function(o){o.stopPropagation()});n.empty().append(q);q.select();if(!a.browser.safari){q.focus()}}function s(){n.empty().text(r)}function p(){var o=a.trim(q.val());if(!h._checkName(o)){n.empty().text(r);return h._showError(h.i18n("Invalid name"),null,true)}else{if(o==u){return s()}}n.empty().text(o);a.ajax({url:d.url,dataType:"json",data:{cmd:"rename",current:h.info.key,target:t.attr("key"),newname:o},error:function(w,v,x){h._showError(v||x)},success:function(v){if(v.error){h._showError(v.error)}else{if(h.showReports){h._showMessage(v.message)}else{h.reload()}}}})}};this.edit=function(q){var n=q.find(".basename").eq(0).attr("title");function p(o){var r=new elDialogForm({submit:function(){},form:{action:d.url},dialog:{title:n,width:800},ajaxForm:{dataType:"json",beforeSubmit:function(){r.showSpinner(h.i18n("Sending data"),true);return true},error:function(u,s,v){h._showError(s||v,r);h._unlock()},success:function(s){h._unlock();if(s.error){h._showError(s.error,r);h.buffer=[];h.updateToolbar()}else{if(h.showReports){h._showMessage(s.message,r)}else{h.reload();r.close()}}}}});r.append(a('<input type="hidden" />').attr("name","cmd").val("edit")).append(a('<input type="hidden" />').attr("name","current").val(h.info.key)).append(a('<input type="hidden" />').attr("name","target").val(q.attr("key"))).append(a('<input type="hidden" />').attr("name","cmd").val("edit")).append(a("<textarea />").attr({name:"content",rows:20}).css("width","99%").val(o)).open()}a.ajax({url:h.options.url,data:{cmd:"open",current:h.info.key,target:q.attr("key")},error:function(s,o,u){h._showError(o+" "+u);h._unlock()},success:function(o){p(o)}})};this.rm=function(){var q=this._selected();if(q){var p=new elDialogForm({submit:function(o){o.preventDefault();n()},dialog:{title:h.i18n("Confirmation required")}});p.showError(h.i18n("Are you shure you want to remove files?<br /> This cannot be undone!")).open()}function n(){p.showSpinner(h.i18n("Sending data"));var o=[];q.each(function(){o.push(a(this).attr("key"))});a.ajax({url:d.url,dataType:"json",data:{cmd:"rm",current:h.info.key,"target[]":o},error:function(u,s,v){h._showError(s||v,p)},success:function(r){if(r.error){h._showError(r.error,p)}else{if(h.showReports){h._showMessage(r.message,p)}else{h.reload();p.close()}}}})}};this.mkdir=function(){var q=a('<input type="text" />');var p=new elDialogForm({submit:function(n){n.preventDefault();o()},dialog:{title:h.i18n("Create directory")}});p.append([h.i18n("Directory name"),q],false,true).open();function o(){var n=a.trim(q.val());if(!n){p.close()}else{if(!h._checkName(n)){p.showError(h.i18n("Invalid directory name")).option("buttons",{Cancel:function(){p.close()},Ok:function(){p.form.trigger("submit")}})}else{p.showSpinner(h.i18n("Sending data"),true);a.ajax({url:d.url,dataType:"json",data:{cmd:"mkdir",current:h.info.key,dirname:n},error:function(u,s,v){h._showError(s||v,p)},success:function(r){if(r.error){p.showError(r.error).option("buttons",{Cancel:function(){p.close()},Ok:function(){p.form.trigger("submit")}})}else{if(h.showReports){h._showMessage(r.message,p)}else{h.reload();p.close()}}}})}}}};this.upload=function(){var q=new elDialogForm({submit:function(){},form:{action:d.url,enctype:"multipart/form-data"},dialog:{title:h.i18n("Upload files")},ajaxForm:{beforeSubmit:function(u,s,r){var t=false;a('input[name="fm-file[]"]',s).each(function(){if(a(this).val().length){t=true}});if(!t){q.showError(h.i18n("Select at least one file to upload"))}else{q.showSpinner(h.i18n("Sending data"),true)}return t},dataType:"json",error:function(u,s,v){h._showError(s||v,q)},success:function(s){if(s.error){h._showError(s.error+"<br />"+s.failed.join("<br />"),q)}else{if(h.showReports||s.failed.length){var r=!s.failed.length?"":'<div class="el-dialogform-error">'+h.i18n("Following files was not uploaded:<br />")+s.failed.join("<br />")+"</div>";q.showMessage(s.message+r,true).option("buttons",{Ok:function(){h.reload();q.close()}})}else{h.reload();q.close()}}}}});var o=a('<input type="file" name="fm-file[]" />');var n=a("<span />").css("cursor","default").append(a("<span />").addClass("ui-icon ui-icon-circle-plus").css({"float":"left","margin-right":".3em"})).append(h.i18n("Add field")).click(function(){q.append(o.clone(),false,true)});if(h.info.allowed){q.append(h.i18n("You can upload only files with following types: ")+h.info.allowed).separator()}q.append(h.i18n("Maximum allowed files size is ")+h.info.postMaxSize).separator().append(a('<input type="hidden" />').attr("name","current").val(h.info.key)).append(a('<input type="hidden" />').attr("name","cmd").val("upload")).append(o.clone(),false,true).append(o.clone(),false,true).append(o.clone(),false,true).separator().append(n).open();function p(){q.showSpinner(h.i18n("Sending data"),true)}};this.swithchView=function(n){h.view=n;elcookie(h.cookieView,n,{expires:1,path:"/"});h.reload()};this.switchReports=function(){h.showReports=h.showReports?0:1;elcookie(h.cookieReports,h.showReports,{expires:1,path:"/"});h.buttons.reports.toggleClass("disabled")};this.help=function(){var p=new elDialogForm({dialog:{width:500,title:h.i18n("Help"),buttons:{Ok:function(){p.close()}}}});var o="<b>"+h.i18n("elFinder: Web file manager")+".<br /> "+h.i18n("Version")+": "+c+"</b><br />";if(d.lang=="en"){o+="elFinder works similar to file manager on your computer. <br /> To make actions on files/folders use icons on top panel. If icon action it is not clear for you, hold mouse cursor over it to see the hint. <br /> Manipulations with existing files/folders can be done through the context menu (mouse right-click). <br /> To copy/delete a group of files/folders, select them using Shift/Alt(Command) + mouse left-click."}else{o+="<br />"+h.i18n("helpText")}var n=h.i18n("Copyright: Studio 42 LTD")+", 2009<br />"+h.i18n("Programming: Dmitry (dio) Levashov, dio@std42.ru")+"<br />"+h.i18n("Techsupport, make file and testing: Troex Nevelin, troex@fury.scancode.ru")+"<br />"+h.i18n("Design: Valentin Razumnih")+"<br />"+h.i18n("License: BSD License")+'<br /><a href="http://www.elrte.ru">www.elrte.ru</a><br />dev@std42.ru';p.tab("help",h.i18n("Help")).tab("authors",h.i18n("Authors")).append(o,"help").append(n,"authors").open()};this._selected=function(o){var n=h.cwd.find(".selected");if(n.length){return o?n.eq(0):n}return null};this._lock=function(){h.nav.addClass("disabled");h.cwd.addClass("disabled")};this._unlock=function(){h.nav.removeClass("disabled");h.cwd.removeClass("disabled")};this._showMessage=function(o,n){if(!n){n=new elDialogForm({dialog:{title:h.i18n("Message")}})}n.showMessage(o,true).open().option("buttons",{Ok:function(){h.reload();n.close()}})};this._showError=function(p,o,n){if(!o){o=new elDialogForm({dialog:{title:h.i18n("Error")}})}o.showError(p,true).open().option("buttons",{Ok:function(){h.reload();o.close()}})};this._checkName=function(n){return n.search("^[^/@!%\"']+$")!=-1}});function e(g){window.console&&window.console.log&&window.console.log(g)}return this};a.fn.elfinder.defaults={url:"",dialog:null,height:450,lang:"en",editorCallback:null,editTextFiles:true};a.fn.elfinder.i18Messages={}})(jQuery);