(function (a) {
	a.fn.elmenu = function (e) {
		var c = a.extend(true, {}, a.fn.elmenu.defaults, e);
		var b = "show";
		var d = "hide";
		if (a.browser.opera) {
			b = "fadeIn";
			d = "fadeOut"
		} else {
			if (c.effect == "slide") {
				b = "slideDown";
				d = "slideUp"
			} else {
				if (c.effect == "fade") {
					b = "fadeIn";
					d = "fadeOut"
				}
			}
		}
		return this.each(function () {
			var g = this;
			a(this).css("z-index", c.zIndex || 10).children("li:first").addClass("first").end().children("li:last").addClass("last").end().find("ul").each(function () {
				a(this).children("li:first").addClass("first").end().children("li:last").addClass("last")
			}).end().find("li").each(function () {
				var k = a(this);
				var l = k.children("ul");
				k.hover(function () {
					k.addClass(c.hoverClass)
				}, function () {
					k.removeClass(c.hoverClass)
				}).children("a").click(function () {
					if (k.parent("ul").get(0) != g) {
						k.trigger("mouseout")
					}
				});
				var n, m;
				if (l.length) {
					if (c.orientation == "horizontal" && k.parent("ul").get(0) == g) {
						m = 0;
						n = parseInt(k.height()) - c.deltaY
					} else {
						m = parseInt(k.width()) - c.deltaX;
						n = c.deltaY
					}
					l.css({
						left: m + "px",
						top: n + "px"
					}).hide();
					k.addClass(c.hasChildsClass);
					if (c.open == "click" && k.parent("ul").get(0) == g) {
						k.click(function () {
							if (l.css("display") != "none") {
								l[d](c.speed)
							} else {
								l[b](c.speed)
							}
						}).hover(function () {}, function () {
							l[d](c.speed)
						})
					} else {
						k.hover(function () {
							l[b](c.speed)
						}, function () {
							l[d](c.speed)
						})
					}
				}
			});
			if (c.draggable) {
				var f = 0;
				a(this).children().each(function () {
					f += a(this).outerWidth()
				});
				a(this).css("width", (f + 5) + "px").draggable().bind("dragstop", function (l, k) {
					elcookie("el-menu-left", parseInt(a(g).offset().left), c.cookie);
					elcookie("el-menu-top", parseInt(a(g).offset().top), c.cookie)
				});
				var j = elcookie("el-menu-top");
				var i = elcookie("el-menu-left");
				var h = parseInt(a(document.body).width());
				if (j !== null && j > 0 && j < parseInt(a(document.body).height())) {
					a(this).css("top", parseInt(j) + "px")
				}
				if (i !== null && i <= h - f) {
					a(this).css("left", parseInt(i) + "px")
				}
			}
		})
	};
	a.fn.elmenu.defaults = {
		orientation: "vertical",
		zIndex: 100,
		hoverClass: "hover",
		hasChildsClass: "has-childs",
		openOn: "hover",
		speed: "fast",
		effect: "",
		deltaX: 5,
		deltaY: 7,
		draggable: false,
		cookie: {
			expires: 1,
			path: "/"
		}
	}
})(jQuery);
