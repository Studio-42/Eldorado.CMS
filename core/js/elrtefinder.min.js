function elcookie(b,k,a){if(typeof k=="undefined"){if(document.cookie&&document.cookie!=""){var o=document.cookie.split(";");var h=b+"=";for(var f=0;f<o.length;f++){var j=$.trim(o[f]);if(j.substring(0,b.length+1)==h){return decodeURIComponent(j.substring(b.length+1))}}}return""}else{a=$.extend({expires:"",path:"",domain:"",secure:false},a);if(k===null){k="";a.expires=-1}var e="";if(a.expires){var g=a.expires.toUTCString?a.expires:new Date();if(typeof a.expires=="number"){g.setTime(g.getTime()+(a.expires*24*60*60*1000))}e="; expires="+g.toUTCString()}document.cookie=b+"="+encodeURIComponent(k)+e+(a.path?"; path="+a.path:"")+(a.domain?"; domain="+a.domain:"")+(a.secure?"; secure":"")}}function eli18n(a){this.textdomain=function(b){return this.messages[b]?this._domain=b:this._domain};a&&a.messages&&this.load(a.messages);a&&a.textdomain&&this.textdomain(a.textdomain)}eli18n.prototype=new function(){this.messages={};this._domain="";this.load=function(c){if(typeof(c)=="object"){for(var e in c){var b=c[e];if(typeof(b)=="object"){if(!this.messages[e]){this.messages[e]={}}for(var a in b){if(typeof(b[a])=="string"){this.messages[e][a]=b[a]}}}}}return this};this.translate=function(b,a){var a=a&&this.messages[a]?a:this._domain;return this.messages[a]&&this.messages[a][b]?this.messages[a][b]:b};this.format=function(e,b,c){e=this.translate(e,c);if(typeof(b)=="object"){for(var a in b){e=e.replace("%"+a,this.translate(b[a],c))}}return e}};function elDialogForm(c){var a=this;var b={"class":"el-dialogform",submit:function(f,g){window.console&&window.console.log&&window.console.log("submit called");g.close()},form:{action:window.location.href,method:"post"},ajaxForm:null,validate:null,spinner:"Loading",tabs:{active:0},tabPrefix:"el-df-tab-",dialog:{title:"dialog",autoOpen:false,modal:true,resizable:false,buttons:{Cancel:function(){a.close()},Ok:function(){a.form.trigger("submit")}}}};this.opts=$.extend(true,b,c,{dialog:{autoOpen:false,close:function(){a.close()}}});if(c&&c.dialog&&c.dialog.buttons&&typeof(c.dialog.buttons)=="object"){this.opts.dialog.buttons=c.dialog.buttons}this.ul=null;this.tabs={};this._table=null;this.dialog=$("<div />").addClass(this.opts["class"]).dialog(this.opts.dialog);this.message=$('<div class="el-dialogform-message rounded-5" />').hide().appendTo(this.dialog);this.error=$('<div class="el-dialogform-error rounded-5" />').hide().appendTo(this.dialog);this.spinner=$('<div class="spinner" />').hide().appendTo(this.dialog);this.content=$('<div class="el-dialogform-content" />').appendTo(this.dialog);this.form=$("<form />").attr(this.opts.form).appendTo(this.content);if(this.opts.submit){this.form.bind("submit",function(d){a.opts.submit(d,a)})}if(this.opts.ajaxForm&&$.fn.ajaxForm){this.form.ajaxForm(this.opts.ajaxForm)}if(this.opts.validate){this.form.validate(this.opts.validate)}this.option=function(d,e){return this.dialog.dialog("option",d,e)};this.showError=function(d,e){this.hideMessage();this.hideSpinner();this.error.html(d).show();e&&this.content.hide();return this};this.hideError=function(){this.error.text("").hide();this.content.show();return this};this.showSpinner=function(d){this.error.hide();this.message.hide();this.content.hide();this.spinner.text(d||this.opts.spinner).show();this.option("buttons",{});return this};this.hideSpinner=function(){this.content.show();this.spinner.hide();return this};this.showMessage=function(d,e){this.hideError();this.hideSpinner();this.message.html(d||"").show();e&&this.content.hide();return this};this.hideMessage=function(){this.message.hide();this.content.show();return this};this.tab=function(e,d){e=this.opts.tabPrefix+e;if(!this.ul){this.ul=$("<ul />").prependTo(this.form)}$("<li />").append($("<a />").attr("href","#"+e).html(d)).appendTo(this.ul);this.tabs[e]={tab:$("<div />").attr("id",e).addClass("tab").appendTo(this.form),table:null};return this};this.table=function(d){d=d&&d.indexOf(this.opts.tabPrefix)==-1?this.opts.tabPrefix+d:d;if(d&&this.tabs&&this.tabs[d]){this.tabs[d].table=$("<table />").appendTo(this.tabs[d].tab)}else{this._table=$("<table />").appendTo(this.form)}return this};this.append=function(g,h,e){h=h?"el-df-tab-"+h:"";if(!g){return this}if(h&&this.tabs[h]){if(e){!this.tabs[h].table&&this.table(h);var f=$("<tr />").appendTo(this.tabs[h].table);if(!$.isArray(g)){f.append($("<td />").append(g))}else{for(var d=0;d<g.length;d++){f.append($("<td />").append(g[d]))}}}else{if(!$.isArray(g)){this.tabs[h].tab.append(g)}else{for(var d=0;d<g.length;d++){this.tabs[h].tab.append(g[d])}}}}else{if(!e){if(!$.isArray(g)){this.form.append(g)}else{for(var d=0;d<g.length;d++){this.form.append(g[d])}}}else{if(!this._table){this.table()}var f=$("<tr />").appendTo(this._table);if(!$.isArray(g)){f.append($("<td />").append(g))}else{for(var d=0;d<g.length;d++){f.append($("<td />").append(g[d]))}}}}return this};this.separator=function(d){d="el-df-tab-"+d;if(this.tabs&&this.tabs[d]){this.tabs[d].tab.append($("<div />").addClass("separator"));this.tabs[d].table&&this.table(d)}else{this.form.append($("<div />").addClass("separator"))}return this};this.open=function(){this.ul&&this.form.tabs(this.opts.tabs);this.form.find(":text").keyup(function(d){if(d.keyCode==13){a.form.submit()}});this.dialog.attr("unselectable","on").dialog("open");this.form.find(":text").eq(0).focus();return this};this.close=function(){this.dialog.dialog("destroy").remove()}}(function(a){a.fn.elColorPicker=function(f){var b=this;var d=a.extend({},a.fn.elColorPicker.defaults,f);this.hidden=a('<input type="hidden" />').attr("name",d.name).val(d.color||"").appendTo(this);this.palette=null;this.preview=null;this.input=null;function c(g){b.val(g);d.change&&d.change(b.val());b.palette.slideUp()}function e(){b.palette=a("<div />").addClass(d.paletteClass+" rounded-3");for(var g=0;g<d.colors.length;g++){a("<div />").addClass("color").css("background-color",d.colors[g]).attr({title:d.colors[g],unselectable:"on"}).appendTo(b.palette).mouseenter(function(){var h=a(this).attr("title");b.input.val(h);b.preview.css("background-color",h)}).click(function(h){h.stopPropagation();c(a(this).attr("title"))})}b.input=a('<input type="text" />').addClass("rounded-3").attr("size",8).click(function(h){h.stopPropagation()}).keydown(function(j){if(j.ctrlKey||j.metaKey){return true}var h=j.keyCode;if(h==27){return b.mouseleave()}if(h!=8&&h!=13&&h!=46&&h!=37&&h!=39&&(h<48||h>57)&&(h<65||h>70)){return false}var o=a(this).val();if(o.length==7||o.length==0){if(h==13){j.stopPropagation();j.preventDefault();c(o);b.palette.slideUp()}if(j.keyCode!=8&&j.keyCode!=46&&h!=37&&h!=39){return false}}}).keyup(function(h){var j=a(this).val();j.length==7&&/^#[0-9abcdef]{6}$/i.test(j)&&b.val(j)});b.preview=a("<div />").addClass("preview rounded-3").click(function(h){h.stopPropagation();c(b.input.val())});b.palette.append(a("<div />").addClass("clearfix")).append(a("<div />").addClass("panel").append(b.input).append(b.preview));if(d.palettePosition=="outer"){b.palette.hide().appendTo(b.parents("body").eq(0)).mouseleave(function(){a(this).slideUp();b.val(b.val())});b.mouseleave(function(h){if(h.relatedTarget!=b.palette.get(0)){b.palette.slideUp();b.val(b.val())}})}else{b.append(b.palette.hide()).mouseleave(function(h){b.palette.slideUp();b.val(b.val())})}b.val(b.val())}this.empty().addClass(d["class"]+" rounded-3").css({position:"relative","background-color":d.color||""}).click(function(j){if(!b.hasClass("disabled")){!b.palette&&e();if(d.palettePosition=="outer"&&b.palette.css("display")=="none"){var k=a(this).offset();var h=b.palette.width();var g=b.parents("body").width()-k.left>=h?k.left:k.left+a(this).outerWidth()-h;b.palette.css({left:g+"px",top:k.top+a(this).height()+1+"px"})}b.palette.slideToggle()}});this.val=function(g){if(!g&&g!==""){return this.hidden.val()}else{this.hidden.val(g);if(d.update){d.update(this.hidden.val())}else{this.css("background-color",g)}if(b.palette){b.preview.css("background-color",g);b.input.val(g)}}return this};return this};a.fn.elColorPicker.defaults={"class":"el-colorpicker",paletteClass:"el-palette",palettePosition:"inner",name:"color",color:"",update:null,change:function(b){window.console&&window.console.log&&window.console.log(b)},colors:["#ffffff","#cccccc","#999999","#666666","#333333","#000000","#ffcccc","#cc9999","#996666","#663333","#330000","#ff9999","#cc6666","#cc3333","#993333","#660000","#ff6666","#ff3333","#ff0000","#cc0000","#990000","#ff9966","#ff6633","#ff3300","#cc3300","#993300","#ffcc99","#cc9966","#cc6633","#996633","#663300","#ff9933","#ff6600","#ff9900","#cc6600","#cc9933","#ffcc66","#ffcc33","#ffcc00","#cc9900","#996600","#ffffcc","#cccc99","#999966","#666633","#333300","#ffff99","#cccc66","#cccc33","#999933","#666600","#ffff66","#ffff33","#ffff00","#cccc00","#999900","#ccff66","#ccff33","#ccff00","#99cc00","#669900","#ccff99","#99cc66","#99cc33","#669933","#336600","#99ff33","#99ff00","#66ff00","#66cc00","#66cc33","#99ff66","#66ff33","#33ff00","#33cc00","#339900","#ccffcc","#99cc99","#669966","#336633","#003300","#99ff99","#66cc66","#33cc33","#339933","#006600","#66ff66","#33ff33","#00ff00","#00cc00","#009900","#66ff99","#33ff66","#00ff33","#00cc33","#009933","#99ffcc","#66cc99","#33cc66","#339966","#006633","#33ff99","#00ff66","#00ff99","#00cc66","#33cc99","#66ffcc","#33ffcc","#00ffcc","#00cc99","#009966","#ccffff","#99cccc","#669999","#336666","#003333","#99ffff","#66cccc","#33cccc","#339999","#006666","#66cccc","#33ffff","#00ffff","#00cccc","#009999","#66ccff","#33ccff","#00ccff","#0099cc","#006699","#99ccff","#6699cc","#3399cc","#336699","#003366","#3399ff","#0099ff","#0066ff","#066ccc","#3366cc","#6699ff","#3366ff","#0033ff","#0033cc","#003399","#ccccff","#9999cc","#666699","#333366","#000033","#9999ff","#6666cc","#3333cc","#333399","#000066","#6666ff","#3333ff","#0000ff","#0000cc","#009999","#9966ff","#6633ff","#3300ff","#3300cc","#330099","#cc99ff","#9966cc","#6633cc","#663399","#330066","#9933ff","#6600ff","#9900ff","#6600cc","#9933cc","#cc66ff","#cc33ff","#cc00ff","#9900cc","#660099","#ffccff","#cc99cc","#996699","#663366","#330033","#ff99ff","#cc66cc","#cc33cc","#993399","#660066","#ff66ff","#ff33ff","#ff00ff","#cc00cc","#990099","#ff66cc","#ff33cc","#ff00cc","#cc0099","#990066","#ff99cc","#cc6699","#cc3399","#993366","#660033","#ff3399","#ff0099","#ff0066","#cc0066","#cc3366","#ff6699","#ff3366","#ff0033","#cc0033","#990033"]}})(jQuery);(function(a){a.fn.elBorderSelect=function(f){var h=this;var k=this.eq(0);var b=a.extend({},a.fn.elBorderSelect.defaults,f);var d=a('<input type="text" />').attr({name:b.name+"[width]",size:3}).css("text-align","right").change(function(){h.change()});var g=a("<div />").css("position","relative").elColorPicker({"class":"el-colorpicker ui-icon ui-icon-pencil",name:b.name+"[color]",palettePosition:"outer",change:function(){h.change()}});var c=a("<div />").elSelect({tpl:'<div style="border-bottom:4px %val #000;width:100%;margin:7px 0"> </div>',tpls:{"":"%label"},maxHeight:b.styleHeight||null,select:function(){h.change()},src:{"":"none",solid:"solid",dashed:"dashed",dotted:"dotted","double":"double",groove:"groove",ridge:"ridge",inset:"inset",outset:"outset"}});k.empty().addClass(b["class"]).attr("name",b.name||"").append(a("<table />").attr("cellspacing",0).append(a("<tr />").append(a("<td />").append(d).append(" px")).append(a("<td />").append(c)).append(a("<td />").append(g))));function e(q){function p(r){hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return !r?"00":hexDigits[(r-r%16)/16]+hexDigits[r%16]}var o=q.match(/\(([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})\)/);return o?"#"+p(o[1])+p(o[2])+p(o[3]):""}function j(p){var o=p.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);if(o){p=o[1];unit=o[2]}if(p[0]=="."){p="0"+p}p=parseFloat(p);if(isNaN(p)){return""}var q=parseInt(a(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(p*q);case"pt":return parseInt(p*q/12);case"%":return parseInt(p*q/100)}return p}this.change=function(){b.change&&b.change(this.val())};this.val=function(r){if(!r&&r!==""){var q=parseInt(d.val());return{width:!isNaN(q)?q+"px":"",style:c.val(),color:g.val()}}else{var p,q,t,u,o="";if(r.nodeName||r.css){if(!r.css){r=a(r)}var o=r.css("border");if((o=r.css("border"))){q=t=u=o}else{q=r.css("border-width");t=r.css("border-style");u=r.css("border-color")}}else{q=r.width||"";t=r.style||"";u=r.color||""}d.val(j(q));var p=t.match(/(solid|dashed|dotted|double|groove|ridge|inset|outset)/i);c.val(p?p[1]:"");g.val(e(u));return this}};this.val(b.value);return this};a.fn.elBorderSelect.defaults={name:"el-borderselect","class":"el-borderselect",value:{},change:null}})(jQuery);(function(d){var a={};var e=document.createElement("div");d.elcontextmenu=function(f,g,h){g=g||document.body;d(e).hide().addClass("el-contextmenu rounded-5").appendTo(document.body);for(name in f){a[name]=f[name];d(name,g).bind(window.opera?"click":"contextmenu",c)}e.callback=h};function c(g){g.stopPropagation();b();if(window.opera&&!g.ctrlKey){return}else{d(document.body).mousedown(function(h){b()})}for(name in a){if(d.inArray(g.currentTarget,d(name))>-1){if(e.callback){e.callback(g)}variants=a[name];d(variants).each(function(){if(!this.label){d("<div />").addClass("delim").appendTo(e)}else{var h=this.action;d("<div></div>").html(this.label).mousedown(function(j){j.stopPropagation();b();if(typeof(h)=="function"){h(g.currentTarget)}}).hover(function(){d(this).addClass("el-contextmenu-hover")},function(){d(this).removeClass("el-contextmenu-hover")}).appendTo(e)}})}}var f={height:d(window).height(),width:d(window).width(),sT:d(window).scrollTop(),cW:d(e).width(),cH:d(e).height()};d(e).css({left:((g.clientX+f.cW)>f.width?(g.clientX-f.cW):g.clientX),top:((g.clientY+f.cH)>f.height&&g.clientY>f.cH?(g.clientY+f.sT-f.cH):g.clientY+f.sT)}).show();return false}function b(f){d(e).hide().empty()}})(jQuery);(function(a){a.fn.eldirtree=function(c){if(!b){var b=c&&c.constructor==Object?a.extend({},a.fn.eldirtree.defaults,c):a.fn.eldirtree.defaults}return this.each(function(){var e=this;if(!this.loaded){this.loaded=true;var d=a(this).addClass(b.cssClass).find("li").prepend(a("<div />")).filter(":has(ul)").children("div").addClass("el-dir-collapsed").click(function(f){if(a(this).hasClass("el-dir-expanded")){a(this).removeClass("el-dir-expanded").next("a").removeClass("el-dir-expanded").parent("li").children("ul").hide()}else{a(this).addClass("el-dir-expanded").next("a").addClass("el-dir-expanded").parent("li").children("ul").show()}}).end().end().end().children("li").find("a").addClass("el-dir-collapsed rounded-3").end();if(d.length==1){d.children("a, div").addClass("el-dir-expanded").end().find("ul li ul").hide()}else{d.find("ul").hide()}d.find("a").bind("click cd",function(f){f.stopPropagation();f.preventDefault();d.find("a").removeClass("selected");a(this).addClass("selected").parent().parents("li").filter(":has(ul)").children("a, div").addClass("el-dir-expanded").end().children("ul").show();f.type=="click"&&b.callback(a(this))});d.eq(0).children("a").addClass("selected")}})};a.fn.eldirtree.defaults={cssClass:"el-dir-tree",callback:function(){}}})(jQuery);(function(a){a.fn.elPaddingInput=function(e){var c=this;var d=a.extend({},a.fn.elPaddingInput.defaults,{name:this.attr("name")},e);this.regexps={main:new RegExp(d.type=="padding"?'paddings*:s*([^;"]+)':'margins*:s*([^;"]+)',"im"),left:new RegExp(d.type=="padding"?'padding-lefts*:s*([^;"]+)':'margin-lefts*:s*([^;"]+)',"im"),top:new RegExp(d.type=="padding"?'padding-tops*:s*([^;"]+)':'margin-tops*:s*([^;"]+)',"im"),right:new RegExp(d.type=="padding"?'padding-rights*:s*([^;"]+)':'margin-rights*:s*([^;"]+)',"im"),bottom:new RegExp(d.type=="padding"?'padding-bottoms*:s*([^;"]+)':'margin-bottoms*:s*([^;"]+)',"im")};a.each(["left","top","right","bottom"],function(){c[this]=a('<input type="text" />').attr("size",3).css("text-align","right").bind("change",function(){a(this).val(b(a(this).val()));f()}).attr("name",d.name+"["+this+"]")});a.each(["uleft","utop","uright","ubottom"],function(){c[this]=a("<select />").append('<option value="px">px</option>').append('<option value="em">em</option>').append('<option value="pt">pt</option>').bind("change",function(){f()}).attr("name",d.name+"["+this+"]");if(d.percents){c[this].append('<option value="%">%</option>')}});this.empty().addClass(d["class"]).append(this.left).append(this.uleft).append(" x ").append(this.top).append(this.utop).append(" x ").append(this.right).append(this.uright).append(" x ").append(this.bottom).append(this.ubottom);this.val=function(u){if(!u&&u!==""){var o=b(this.left.val());var w=b(this.top.val());var g=b(this.right.val());var s=b(this.bottom.val());var q={left:o=="auto"||o==0?o:(o!==""?o+this.uleft.val():""),top:w=="auto"||w==0?w:(w!==""?w+this.utop.val():""),right:g=="auto"||g==0?g:(g!==""?g+this.uright.val():""),bottom:s=="auto"||s==0?s:(s!==""?s+this.ubottom.val():""),css:""};if(q.left!==""&&q.right!==""&&q.top!==""&&q.bottom!==""){if(q.left==q.right&&q.top==q.bottom){q.css=q.top+" "+q.left}else{q.css=q.top+" "+q.right+" "+q.bottom+" "+q.left}}return q}else{if(u.nodeName||u.css){if(!u.css){u=a(u)}var j={left:"",top:"",right:"",bottom:""};var h=(u.attr("style")||"").toLowerCase();if(h){h=a.trim(h);var k=h.match(this.regexps.main);if(k){var p=a.trim(k[1]).replace(/\s+/g," ").split(" ",4);j.top=p[0];j.right=p[1]&&p[1]!==""?p[1]:j.top;j.bottom=p[2]&&p[2]!==""?p[2]:j.top;j.left=p[3]&&p[3]!==""?p[3]:j.right}else{a.each(["left","top","right","bottom"],function(){var r=this.toString();k=h.match(c.regexps[r]);if(k){j[r]=k[1]}})}}var u=j}a.each(["left","top","right","bottom"],function(){var t=this.toString();if(typeof(u[t])!="undefined"&&u[t]!==null){u[t]=u[t].toString();var v=b(u[t]);c[t].val(v);var r=u[t].match(/(px|em|pt|%)/i);c["u"+t].val(r?r[1]:"px")}});return this}};function b(g){g=a.trim(g.toString());if(g[0]=="."){g="0"+g}n=parseFloat(g);return !isNaN(n)?n:(g=="auto"?g:"")}function f(){d.change&&d.change(c)}this.val(d.value);return this};a.fn.elPaddingInput.defaults={name:"el-paddinginput","class":"el-paddinginput",type:"padding",value:{},percents:true,change:null}})(jQuery);(function(a){a.fn.elSelect=function(c){var k=this;var r=this.eq(0);var b=a.extend({},a.fn.elSelect.defaults,c);var e=a('<input type="hidden" />').attr("name",b.name);var j=a("<label />").attr({unselectable:"on"}).addClass("rounded-left-3");var f=null;var h=null;if(r.get(0).nodeName=="SELECT"){b.src={};r.children("option").each(function(){b.src[a(this).val()]=a(this).text()});b.value=r.val();b.name=r.attr("name");r.replaceWith((r=a("<div />")))}if(!b.value||!b.src[b.val]){b.value=null;var d=0;for(var p in b.src){if(d++==0){b.value=p}}}this.val=function(o){if(!o&&o!==""){return e.val()}else{if(b.src[o]){e.val(o);g(o);if(f){f.children().each(function(){if(a(this).attr("name")==o){a(this).addClass("active")}else{a(this).removeClass("active")}})}}return this}};function g(o){var s=b.labelTpl||b.tpls[o]||b.tpl;j.html(s.replace(/%val/g,o).replace(/%label/,b.src[o])).children().attr({unselectable:"on"})}r.empty().addClass(b["class"]+" rounded-3").attr({unselectable:"on"}).append(e).append(j).hover(function(){a(this).addClass("hover")},function(){a(this).removeClass("hover")}).click(function(o){!f&&q();f.slideToggle();if(a.browser.msie&&!h){f.children().each(function(){h=Math.max(h,a(this).width())});if(h>f.width()){f.width(h+40)}}});this.val(b.value);function q(){f=a("<div />").addClass(b.listClass+" rounded-3").hide().appendTo(r.mouseleave(function(v){f.slideUp()}));for(var s in b.src){var t=b.tpls[s]||b.tpl;a("<div />").attr("name",s).append(a(t.replace(/%val/g,s).replace(/%label/g,b.src[s])).attr({unselectable:"on"})).appendTo(f).hover(function(){a(this).addClass("hover")},function(){a(this).removeClass("hover")}).click(function(x){x.stopPropagation();x.preventDefault();var w=a(this).attr("name");k.val(w);b.select(w);f.slideUp()})}var o=r.outerWidth();if(f.width()<o){f.width(o)}var u=f.height();if(b.maxHeight>0&&u>b.maxHeight){f.height(b.maxHeight)}k.val(e.val())}return this};a.fn.elSelect.defaults={name:"el-select","class":"el-select",listClass:"list",labelTpl:null,tpl:"<%val>%label</%val>",tpls:{},value:null,src:{},select:function(b){window.console&&window.console.log&&window.console.log("selected: "+b)},maxHeight:310}})(jQuery);(function(a){a.fn.elfinder=function(f){var d={};var c="1.01";var b=["list","ismall","ibig"];if(f&&f.constructor==Object){d=a.extend({},a.fn.elfinder.defaults,f)}if(!d.url){alert("Invalid configuration! Connector URL required!");return}return this.each(function(){var h=this;var p=a(this);var q=p.attr("id");this.tree=null;this.nav=null;this.cwd=null;this.fnum=null;this.fsize=null;this.info={};this.history=[];this.buttons={};this.buffer=[];this._i18n=new eli18n({textdomain:"elfinder",messages:{elfinder:a.fn.elfinder.i18Messages[d.lang]||{}}});this.cookieView="elfinder-view-"+q;this.cookieReports="elfinder-reports-"+q;this.i18n=function(r){return h._i18n.translate(r)};var g=elcookie(this.cookieView);this.view=g&&a.inArray(g,b)?g:"list";var o=elcookie(this.cookieReports);this.showReports=o?(o>0?1:0):1;var j={".dir-r":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(r){h._open(a(r))}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(r){h.copy()}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(r){h.getInfo(a(r))}}],".dir-rw":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(r){h._open(a(r))}},{label:'<span class="icon icon-rename"></span>'+this.i18n("Rename"),action:function(r){h.rename(a(r))}},{label:'<span class="icon icon-rm"></span>'+this.i18n("Delete"),action:function(r){h.rm()}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(r){h.copy()}},{label:'<span class="icon icon-cut"></span>'+this.i18n("Cut"),action:function(r){h.copy(true)}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(r){h.getInfo(a(r))}}],".file-r":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(r){h._open(a(r))}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(r){h.copy()}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(r){h.getInfo(a(r))}}],".file-rw":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(r){h._open(a(r))}},{label:'<span class="icon icon-rename"></span>'+this.i18n("Rename"),action:function(r){h.rename(a(r))}},{label:'<span class="icon icon-rm"></span>'+this.i18n("Delete"),action:function(r){h.rm()}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(r){h.copy()}},{label:'<span class="icon icon-cut"></span>'+this.i18n("Cut"),action:function(r){h.copy(true)}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(r){h.getInfo(a(r))}}],".image-r":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(r){h._open(a(r))}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(r){h.copy()}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(r){h.getInfo(a(r))}}],".image-rw":[{label:'<span class="icon icon-open"></span>'+this.i18n("Open"),action:function(r){h._open(a(r))}},{label:'<span class="icon icon-rename"></span>'+this.i18n("Rename"),action:function(r){h.rename(a(r))}},{label:'<span class="icon icon-rm"></span>'+this.i18n("Delete"),action:function(r){h.rm()}},{},{label:'<span class="icon icon-copy"></span>'+this.i18n("Copy"),action:function(r){h.copy()}},{label:'<span class="icon icon-cut"></span>'+this.i18n("Cut"),action:function(r){h.copy(true)}},{},{label:'<span class="icon icon-info"></span>'+this.i18n("Get info"),action:function(r){h.getInfo(a(r))}}],".el-finder-cwd":[]};if(d.editorCallback){var k={label:'<span class="icon icon-select"></span>'+this.i18n("Select file"),action:function(r){h.selectFile(a(r))}};j[".file-r"].unshift(k);j[".file-rw"].unshift(k);j[".image-r"].unshift(k);j[".image-rw"].unshift(k)}if(!this.loaded){if(!this.options){this.options=d;if(this.options.dialog){a.extend(this.options.dialog,{close:function(){h.loaded=false;p.dialog("destroy")}})}}a.ajax({url:this.options.url,cache:false,data:{view:this.view},error:function(u,s,v){alert(s+" "+v)},success:function(r){h.init(r)}})}if(f=="open"){this.open()}else{if(f=="close"){this.close()}}this.open=function(){if(this.options.dialog){p.dialog("open")}else{p.show()}};this.close=function(){if(this.options.dialog){this.loaded=false;p.dialog("close")}else{p.hide()}};this.init=function(s){p.empty().html(s);if(!p.children(".el-finder").length){return p.empty().html(this.i18n("Invalid backend configuration"))}this.loaded=true;var r=p.find("ul.el-finder-toolbar");this.buttons={back:r.children(".button-back").click(function(){!a(this).hasClass("disabled")&&h.back()}),reload:r.children(".button-reload").bind("click",h.reload),select:r.children(".button-select").click(function(){!a(this).hasClass("disabled")&&h.selectFile(h._selected(true))}),open:r.children(".button-open").click(function(){!a(this).hasClass("disabled")&&h._open(h._selected(true))}),edit:r.children(".button-edit").click(function(){!a(this).hasClass("disabled")&&h.edit(h._selected(true))}),rename:r.children(".button-rename").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.rename(h._selected(true))}),rm:r.children(".button-rm").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.rm()}),info:r.children(".button-info").click(function(){!a(this).hasClass("disabled")&&h.getInfo(h._selected(true))}),mkdir:r.children(".button-mkdir").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.mkdir()}),upload:r.children(".button-upload").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.upload()}),copy:r.children(".button-copy").click(function(){!a(this).hasClass("disabled")&&h.copy()}),cut:r.children(".button-cut").click(function(){!a(this).hasClass("disabled")&&h.copy(h.info.write)}),paste:r.children(".button-paste").click(function(){!a(this).hasClass("disabled")&&h.info.write&&h.paste()}),ibig:r.children(".button-ibig").click(function(){!a(this).hasClass("disabled")&&h.swithchView("ibig")}),ismall:r.children(".button-ismall").click(function(){!a(this).hasClass("disabled")&&h.swithchView("ismall")}),list:r.children(".button-list").click(function(){!a(this).hasClass("disabled")&&h.swithchView("list")}),reports:r.children(".button-reports").bind("click",h.switchReports),help:r.children(".button-help").bind("click",h.help)};if(!this.options.editorCallback){this.buttons.select.hide()}if(!this.options.editTextFiles){this.buttons.edit.hide()}this.fnum=p.find(".files-num");this.fsize=p.find(".files-size");this.cwd=p.find(".el-finder-cwd").click(function(t){if(t.target==this){h.cwd.find(".selected").removeClass("selected");h.updateToolbar()}}).bind("update",function(){h.info=h.cwd.children().eq(0).metadata();a(this).find(".item").bind("dblclick",function(u){u.stopPropagation();var t=a(this);if(!t.hasClass("disabled")){h._open(a(this))}}).bind("click",function(z){var x=a(this);var v=x.hasClass("selected");if(!z.ctrlKey&&!z.metaKey&&!z.shiftKey){h.cwd.find(".selected").removeClass("selected")}else{if(z.shiftKey){var w=x.prevAll(".selected").get(0);var u=x.nextAll(".selected").get(0);var t=false;if(w){x.prevAll(".item").each(function(){if(this==w){t=true;a(this).addClass("selected")}else{if(!t){a(this).addClass("selected")}else{a(this).removeClass("selected")}}});x.nextAll(".selected").removeClass("selected")}else{if(u){x.nextAll(".item").each(function(){if(this==u){t=true;a(this).addClass("selected")}else{if(!t){a(this).addClass("selected")}else{a(this).removeClass("selected")}}});x.prevAll(".selected").removeClass("selected")}}}}if(!v){x.addClass("selected")}else{x.removeClass("selected")}h.updateToolbar()});if(!h.info.write){j[".el-finder-cwd"]=[{label:'<span class="icon icon-reload"></span>'+h.i18n("Reload"),action:function(t){h.reload()}}]}else{j[".el-finder-cwd"]=[{label:'<span class="icon icon-reload"></span>'+h.i18n("Reload"),action:function(t){h.reload()}},{},{label:'<span class="icon icon-paste"></span>'+h.i18n("Paste"),action:function(t){h.paste()}},{},{label:'<span class="icon icon-mkdir"></span>'+h.i18n("Create directory"),action:function(t){h.mkdir()}},{label:'<span class="icon icon-upload"></span>'+h.i18n("Upload files"),action:function(t){h.upload()}}]}a.elcontextmenu(j,h,function(t){if(window.opera&&!t.ctrlKey){return}if(!a(t.currentTarget).hasClass("el-finder-cwd")){a(t.currentTarget).addClass("selected")}});h.updateToolbar();h._unlock();h.fnum.text(h.info.filesNum);h.fsize.text(h.info.filesSize)});this.nav=p.find(".el-finder-nav").bind("update",function(){h.tree=p.find(".el-dir-tree").eldirtree({callback:h.cd});h.tree.find('[key="'+h.info.key+'"]').trigger("cd");h._unlock()});if(this.options.height){this.cwd.css("height",this.options.height+"px");this.nav.css("height",this.options.height+"px")}this.cwd.trigger("update");this.nav.trigger("update");if(this.options.dialog){p.dialog(this.options.dialog).parent().find(".ui-dialog-content").css("padding","0")}a(document).bind("keydown",function(t){if(t.keyCode==46||(t.metaKey&&t.keyCode==8)){h.rm()}else{if(t.ctrlKey||t.metaKey){if(t.keyCode==67){h.copy()}else{if(t.keyCode==88){h.copy(true)}else{if(t.keyCode==86){h.paste()}}}}}})};this.updateToolbar=function(){if(h.history.length){h.buttons.back.removeClass("disabled")}else{h.buttons.back.addClass("disabled")}var u=this._selected();if(this.options.editorCallback){if(u&&u.length==1&&!u.eq(0).hasClass("dir-r")&&!u.eq(0).hasClass("dir-rw")){h.buttons.select.removeClass("disabled")}else{h.buttons.select.addClass("disabled")}}if(this.options.editTextFiles){if(u&&u.length==1&&u.eq(0).attr("class").match(/text/)){h.buttons.edit.removeClass("disabled")}else{h.buttons.edit.addClass("disabled")}}if(u){h.buttons.open.removeClass("disabled");h.buttons.info.removeClass("disabled");h.buttons.copy.removeClass("disabled");if(h.info.write){h.buttons.rename.removeClass("disabled");h.buttons.rm.removeClass("disabled");h.buttons.cut.removeClass("disabled")}}else{h.buttons.open.addClass("disabled");h.buttons.info.addClass("disabled");h.buttons.rename.addClass("disabled");h.buttons.copy.addClass("disabled");h.buttons.rm.addClass("disabled");h.buttons.cut.addClass("disabled")}if(h.buffer.length){h.buttons.paste.removeClass("disabled")}else{h.buttons.paste.addClass("disabled")}if(h.info.write){h.buttons.mkdir.removeClass("disabled");h.buttons.upload.removeClass("disabled")}else{h.buttons.rename.addClass("disabled");h.buttons.mkdir.addClass("disabled");h.buttons.upload.addClass("disabled");h.buttons.paste.addClass("disabled")}for(var t=0;t<b.length;t++){var r=b[t];if(r==h.view){h.buttons[r].addClass("disabled")}else{h.buttons[r].removeClass("disabled")}}if(h.showReports>0){h.buttons.reports.removeClass("disabled")}else{h.buttons.reports.addClass("disabled")}};this._open=function(r){if(r){if(r.hasClass("dir-r")||r.hasClass("dir-rw")){this.cd(r)}else{window.open(d.url+"?cmd=open&current="+this.info.key+"&target="+r.attr("key"),null,"top=50,left=50,scrollbars=yes,resizable=yes")}}};this.cd=function(s){h._lock();h.history.push(h.info.key);var r=typeof(s)=="object"?s.attr("key"):s;a.ajax({url:d.url,cache:false,data:{cmd:"cd",target:r,view:h.view},error:function(v,u,w){h._showError(u+" "+w);h._unlock()},success:function(t){h.cwd.empty().html(t).trigger("update");h.nav.trigger("update")}})};this.reload=function(){h.cd(h.info.key);a.ajax({url:d.url,data:{cmd:"tree",target:h.info.key},error:function(u,s,v){h._showError(s+" "+v);h._unlock()},success:function(r){h.nav.html(r).trigger("update")}})};this.back=function(){if(!this.buttons.back.hasClass("disabled")&&this.history.length){this.cd(this.history.pop());this.history.pop()}};this.selectFile=function(r){if(d.editorCallback){a.ajax({url:d.url,dataType:"json",data:{cmd:"url",current:h.info.key,target:a(r).attr("key")},error:function(u,s,v){h._showError(s+" "+v)},success:function(s){d.editorCallback(s.url);if(h.options.dialog){h.close()}}})}};this.getInfo=function(r){if(r){h._lock();a.ajax({url:d.url,data:{cmd:"info",current:h.info.key,target:r.attr("key")},error:function(u,s,v){h._showError(s+" "+v);h._unlock()},success:function(s){var t=new elDialogForm({dialog:{title:h.i18n("File info"),buttons:{Ok:function(){t.close()}}}});t.append(s).open();h._unlock()}})}};this.copy=function(t){this.buffer=[];var r=this._selected();if(r){this.buffer=[this.info.key,[],!!(this.info.write&&t)];a.each(r,function(){h.buffer[1].push(a(this).attr("key"))})}this.updateToolbar()};this.paste=function(){if(this.buffer.length){h._lock();a.ajax({url:d.url,dataType:"json",data:{cmd:"copy",current:h.info.key,source:h.buffer[0],"files[]":h.buffer[1],move:h.buffer[2]},error:function(u,s,v){h._showError(s+" "+v);h._unlock()},success:function(r){h._unlock();if(r.error){h._showError(r.error);h.buffer=[];h.updateToolbar()}else{if(h.showReports){h._showMessage(r.message)}else{h.reload()}}}})}};this.rename=function(w){if(w){var r=w.find(".basename").eq(0);var u=r.text();var x=r.attr("title");var t=a('<input type="text" />').val(x).keyup(function(z){if(z.keyCode==27){v()}else{if(z.keyCode==13){s()}}}).bind("change blur",function(){s()}).click(function(z){z.stopPropagation()});r.empty().append(t);t.select();if(!a.browser.safari){t.focus()}}function v(){r.empty().text(u)}function s(){var z=a.trim(t.val());if(!h._checkName(z)){r.empty().text(u);return h._showError(h.i18n("Invalid name"),null,true)}else{if(z==x){return v()}}r.empty().text(z);a.ajax({url:d.url,dataType:"json",data:{cmd:"rename",current:h.info.key,target:w.attr("key"),newname:z},error:function(B,A,C){h._showError(A||C)},success:function(A){if(A.error){h._showError(A.error)}else{if(h.showReports){h._showMessage(A.message)}else{h.reload()}}}})}};this.edit=function(t){var r=t.find(".basename").eq(0).attr("title");function s(u){var v=new elDialogForm({submit:function(){},form:{action:d.url},dialog:{title:r,width:800},ajaxForm:{dataType:"json",beforeSubmit:function(){v.showSpinner(h.i18n("Sending data"),true);return true},error:function(x,w,z){h._showError(w||z,v);h._unlock()},success:function(w){h._unlock();if(w.error){h._showError(w.error,v);h.buffer=[];h.updateToolbar()}else{if(h.showReports){h._showMessage(w.message,v)}else{h.reload();v.close()}}}}});v.append(a('<input type="hidden" />').attr("name","cmd").val("edit")).append(a('<input type="hidden" />').attr("name","current").val(h.info.key)).append(a('<input type="hidden" />').attr("name","target").val(t.attr("key"))).append(a('<input type="hidden" />').attr("name","cmd").val("edit")).append(a("<textarea />").attr({name:"content",rows:20}).css("width","99%").val(u)).open()}a.ajax({url:h.options.url,data:{cmd:"open",current:h.info.key,target:t.attr("key")},error:function(v,u,w){h._showError(u+" "+w);h._unlock()},success:function(u){s(u)}})};this.rm=function(){var t=this._selected();if(t){var s=new elDialogForm({submit:function(u){u.preventDefault();r()},dialog:{title:h.i18n("Confirmation required")}});s.showError(h.i18n("Are you shure you want to remove files?<br /> This cannot be undone!")).open()}function r(){s.showSpinner(h.i18n("Sending data"));var u=[];t.each(function(){u.push(a(this).attr("key"))});a.ajax({url:d.url,dataType:"json",data:{cmd:"rm",current:h.info.key,"target[]":u},error:function(w,v,x){h._showError(v||x,s)},success:function(v){if(v.error){h._showError(v.error,s)}else{if(h.showReports){h._showMessage(v.message,s)}else{h.reload();s.close()}}}})}};this.mkdir=function(){var t=a('<input type="text" />');var s=new elDialogForm({submit:function(u){u.preventDefault();r()},dialog:{title:h.i18n("Create directory")}});s.append([h.i18n("Directory name"),t],false,true).open();function r(){var u=a.trim(t.val());if(!u){s.close()}else{if(!h._checkName(u)){s.showError(h.i18n("Invalid directory name")).option("buttons",{Cancel:function(){s.close()},Ok:function(){s.form.trigger("submit")}})}else{s.showSpinner(h.i18n("Sending data"),true);a.ajax({url:d.url,dataType:"json",data:{cmd:"mkdir",current:h.info.key,dirname:u},error:function(w,v,x){h._showError(v||x,s)},success:function(v){if(v.error){s.showError(v.error).option("buttons",{Cancel:function(){s.close()},Ok:function(){s.form.trigger("submit")}})}else{if(h.showReports){h._showMessage(v.message,s)}else{h.reload();s.close()}}}})}}}};this.upload=function(){var u=new elDialogForm({submit:function(){},form:{action:d.url,enctype:"multipart/form-data"},dialog:{title:h.i18n("Upload files")},ajaxForm:{beforeSubmit:function(z,w,v){var x=false;a('input[name="fm-file[]"]',w).each(function(){if(a(this).val().length){x=true}});if(!x){u.showError(h.i18n("Select at least one file to upload"))}else{u.showSpinner(h.i18n("Sending data"),true)}return x},dataType:"json",error:function(w,v,x){h._showError(v||x,u)},success:function(w){if(w.error){h._showError(w.error+"<br />"+w.failed.join("<br />"),u)}else{if(h.showReports||w.failed.length){var v=!w.failed.length?"":'<div class="el-dialogform-error">'+h.i18n("Following files was not uploaded:<br />")+w.failed.join("<br />")+"</div>";u.showMessage(w.message+v,true).option("buttons",{Ok:function(){h.reload();u.close()}})}else{h.reload();u.close()}}}}});var s=a('<input type="file" name="fm-file[]" />');var r=a("<span />").css("cursor","default").append(a("<span />").addClass("ui-icon ui-icon-circle-plus").css({"float":"left","margin-right":".3em"})).append(h.i18n("Add field")).click(function(){u.append(s.clone(),false,true)});if(h.info.allowed){u.append(h.i18n("You can upload only files with following types: ")+h.info.allowed).separator()}u.append(h.i18n("Maximum allowed files size is ")+h.info.postMaxSize).separator().append(a('<input type="hidden" />').attr("name","current").val(h.info.key)).append(a('<input type="hidden" />').attr("name","cmd").val("upload")).append(s.clone(),false,true).append(s.clone(),false,true).append(s.clone(),false,true).separator().append(r).open();function t(){u.showSpinner(h.i18n("Sending data"),true)}};this.swithchView=function(r){h.view=r;elcookie(h.cookieView,r,{expires:1,path:"/"});h.reload()};this.switchReports=function(){h.showReports=h.showReports?0:1;elcookie(h.cookieReports,h.showReports,{expires:1,path:"/"});h.buttons.reports.toggleClass("disabled")};this.help=function(){var t=new elDialogForm({dialog:{width:500,title:h.i18n("Help"),buttons:{Ok:function(){t.close()}}}});var s="<b>"+h.i18n("elFinder: Web file manager")+".<br /> "+h.i18n("Version")+": "+c+"</b><br />";if(d.lang=="en"){s+="elFinder works similar to file manager on your computer. <br /> To make actions on files/folders use icons on top panel. If icon action it is not clear for you, hold mouse cursor over it to see the hint. <br /> Manipulations with existing files/folders can be done through the context menu (mouse right-click). <br /> To copy/delete a group of files/folders, select them using Shift/Alt(Command) + mouse left-click."}else{s+="<br />"+h.i18n("helpText")}var r=h.i18n("Copyright: Studio 42 LTD")+", 2009<br />"+h.i18n("Programming: Dmitry (dio) Levashov, dio@std42.ru")+"<br />"+h.i18n("Techsupport, make file and testing: Troex Nevelin, troex@fury.scancode.ru")+"<br />"+h.i18n("Design: Valentin Razumnih")+"<br />"+h.i18n("License: BSD License")+'<br /><a href="http://www.elrte.ru">www.elrte.ru</a><br />dev@std42.ru';t.tab("help",h.i18n("Help")).tab("authors",h.i18n("Authors")).append(s,"help").append(r,"authors").open()};this._selected=function(t){var r=h.cwd.find(".selected");if(r.length){return t?r.eq(0):r}return null};this._lock=function(){h.nav.addClass("disabled");h.cwd.addClass("disabled")};this._unlock=function(){h.nav.removeClass("disabled");h.cwd.removeClass("disabled")};this._showMessage=function(s,r){if(!r){r=new elDialogForm({dialog:{title:h.i18n("Message")}})}r.showMessage(s,true).open().option("buttons",{Ok:function(){h.reload();r.close()}})};this._showError=function(t,s,r){if(!s){s=new elDialogForm({dialog:{title:h.i18n("Error")}})}s.showError(t,true).open().option("buttons",{Ok:function(){h.reload();s.close()}})};this._checkName=function(r){return r.search("^[^/@!%\"']+$")!=-1}});function e(g){window.console&&window.console.log&&window.console.log(g)}return this};a.fn.elfinder.defaults={url:"",dialog:null,height:450,lang:"en",editorCallback:null,editTextFiles:true};a.fn.elfinder.i18Messages={}})(jQuery);(function(a){elRTE=function(d,c){var b=this;this.version="1.0 RC1";this.options=a.extend(true,{},this.options,c);this.browser=a.browser;this.editor=a("<div />").addClass(this.options.cssClass);this.toolbar=a("<div />").addClass("toolbar").appendTo(this.editor);this.iframe=document.createElement("iframe");this.workzone=a("<div />").addClass("workzone").appendTo(this.editor).append(this.iframe);this.statusbar=a("<div />").addClass("statusbar").appendTo(this.editor);this.tabsbar=a("<div />").addClass("tabsbar").appendTo(this.editor);this.source=a("<textarea />").appendTo(this.workzone).hide();this.target=null;this.doc=null;this.window=null;this.utils=new this.utils(this);this.dom=new this.dom(this);this._i18n=new eli18n({textdomain:"rte",messages:{rte:this.i18Messages[this.options.lang]||{}}});if(!d||!d.nodeName){alert('elRTE: argument "target" is not DOM Element');return}this.init=function(){this.options.height>0&&this.workzone.height(this.options.height);var g=this.filter(d.nodeName=="TEXTAREA"?a(d).val():a(d).html(),true);this.source.val(g);this.source.attr("name",a(d).attr("name")||a(d).attr("id"));if(this.options.allowSource){this.tabsbar.append(a("<div />").text(b.i18n("Editor")).addClass("tab editor rounded-bottom-7 active")).append(a("<div />").text(b.i18n("Source")).addClass("tab source rounded-bottom-7")).append(a("<div />").addClass("clearfix"))}this.target=a(d).replaceWith(this.editor);this.window=this.iframe.contentWindow;this.doc=this.iframe.contentWindow.document;html='<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';if(b.options.cssfiles.length){a.each(b.options.cssfiles,function(){html+='<link rel="stylesheet" type="text/css" href="'+this+'" />'})}html=b.options.doctype+html+"</head><body>"+g+"</body></html>";this.doc.open();this.doc.write(html);this.doc.close();if(!this.doc.body.firstChild){this.doc.body.appendChild(this.doc.createElement("br"))}if(this.browser.msie){this.doc.body.contentEditable=true}else{try{this.doc.designMode="on"}catch(f){}this.doc.execCommand("styleWithCSS",false,this.options.styleWithCSS)}this.window.focus();this.selection=new this.selection(this);this.ui=new this.ui(this);this.editor.parents("form").eq(0).submit(function(h){if(b.source.css("display")=="none"){b.updateSource()}b.toolbar.find(":hidden").remove()});a(this.doc).keydown(function(h){if(b.browser.safari&&h.keyCode==13){if(h.shiftKey||!b.dom.parent(b.selection.getNode(),/^(P|LI)$/)){b.selection.insertNode(b.doc.createElement("br"));return false}}}).bind("keyup mouseup",function(h){if(h.type=="mouseup"||h.ctrlKey||h.metaKey||(h.keyCode>=8&&h.keyCode<=13)||(h.keyCode>=32&&h.keyCode<=40)||h.keyCode==46||(h.keyCode>=96&&h.keyCode<=111)){b.ui.update()}})};this.init()};elRTE.prototype.i18n=function(b){return this._i18n.translate(b)};elRTE.prototype.open=function(){this.editor.show();this.target.hide()};elRTE.prototype.close=function(){this.editor.hide();this.target.show()};elRTE.prototype.updateEditor=function(){a(this.doc.body).html(this.filter(this.source.val(),true));this.window.focus();this.ui.update(true)};elRTE.prototype.updateSource=function(){this.source.val(this.filter(a(this.doc.body).html()))};elRTE.prototype.val=function(b){if(b){a(this.doc.body).html(this.filter(b,true))}else{this.updateSource();return this.source.val()}};elRTE.prototype.save=function(){this.editor.parents("form").submit()};elRTE.prototype.filter=function(d,c){var e="";var f=a("<span />");if(!d.nodeType){e=a.trim(d)}else{e=a.trim(d.nodeType==1?a(d).html():d.nodeValue)}var b=this.options.stripWhiteSpace;a.each(this.filters.html,function(){e=this(e,b)});f.html(e);if(c){f.find("a").each(function(){if(a(this).attr("name")){a(this).addClass("el-rte-anchor")}})}else{f.find("a.el-rte-anchor").each(function(){if(a.trim(a(this).attr("class"))=="el-rte-anchor"){a(this).removeAttr("class")}else{a(this).removeClass("el-rte-anchor")}})}a.each(this.filters.dom,function(){f=this(f)});return f.html()};elRTE.prototype.filters={dom:[function(b){b.find("[align]").not("tbody,tr").each(function(){var c=(a(this).attr("align")||"").toLowerCase();if((this.nodeName!="TD"&&this.nodeName!="TH")||c!="left"){a(this).css("text-align",c).removeAttr("align")}}).end().end().find("[border],[bordercolor]").each(function(){var d=parseInt(a(this).attr("border"))||1,e=a(this).attr("bordercolor")||"#000";a(this).css("border",d+"px solid "+e).removeAttr("border").removeAttr("bordercolor")}).end().find("[bgcolor]").each(function(){a(this).css("background-color",a(this).attr("bgcolor")).removeAttr("bgcolor")}).end().find("[background]").each(function(){a(this).css("background","url("+a(this).attr("background")+")").removeAttr("background")}).end().find("img[hspace],[vspace]").each(function(){var c=parseInt(a(this).attr("vspace"))||0,d=parseInt(a(this).attr("hspace"))||0;if(c>0||d>0){a(this).css("margin",(c>0?c:0)+"px "+(d>0?d:0)+"px")}a(this).removeAttr("hspace").removeAttr("vspace")}).end().find("[clear]").each(function(){var d=(a(this).attr("clear")||"").toLowerCase();a(this).css("clear",d=="all"?"both":d)});if(a.browser.safari){b.find(".Apple-style-span").removeClass("Apple-style-span")}return b}],html:[function(c,d){var b={1:"xx-small",2:"x-small",3:"small",4:"medium",5:"large",6:"x-large",7:"xx-large"};c=c.replace(/<font([^>]*)/i,function(h,f){var g="",e=f.match(/size=('|")(\d)/i);if(e&&e[2]&&b[e[2]]){g="font-size: "+b[e[2]]+"; "}e=f.match(/face=('|")([a-z0-9\s,]+)/i);if(e&&e[2]){g+="font-family: "+e[2]}return"<span"+(g?' style="'+g+'"':"")}).replace(/<\/font/i,"</span").replace(/<b(\s[^>]*)?>/i,"<strong$1>").replace(/<\/b\s*>/i,"</strong>").replace(/<i(\s[^>]*)?>/i,"<em$1>").replace(/<\/i\s*>/i,"</em>").replace(/((class|style)="")/i,"");if(d){c=c.replace(/\r?\n(\s)*/mg,"\n")}return c}]};elRTE.prototype.log=function(b){if(window.console&&window.console.log){window.console.log(b)}};elRTE.prototype.i18Messages={};a.fn.elrte=function(b){return this.each(function(){var c=new elRTE(this,b)})}})(jQuery);elRTE.prototype.dom=function(b){this.rte=b;var a=this;this.regExp={textNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TD|TH|TT|VAR)$/,textContainsNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DL|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|OL|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|TT|UL|VAR)$/,block:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|UL)$/,selectionBlock:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TD|TH|TR|UL)$/,header:/^H[1-6]$/,formElement:/^(FORM|INPUT|HIDDEN|TEXTAREA|SELECT|BUTTON)$/};this.root=function(){return this.rte.body};this.create=function(c){return this.rte.doc.createElement(c)};this.indexOf=function(d){var c=0;d=$(d);while((d=d.prev())&&d.length){c++}return c};this.attr=function(e,c){var d="";if(e.nodeType==1){d=$(e).attr(c);if(d&&c!="src"&&c!="href"){d=d.toString().toLowerCase()}}return d||""};this.findCommonAncestor=function(g,f){if(!g||!f){return this.rte.log("dom.findCommonAncestor invalid arguments")}if(g==f){return g}else{if(g.nodeName=="BODY"||f.nodeName=="BODY"){return this.rte.doc.body}}var j=$(g).parents(),h=$(f).parents(),d=h.length-1,k=h[d];for(var e=j.length-1;e>=0;e--,d--){if(j[e]==h[d]){k=j[e]}else{break}}return k};this.isEmpty=function(c){if(c.nodeType==1){return this.regExp.textNodes.test(c.nodeName)?$.trim($(c).text()).length==0:false}else{if(c.nodeType==3){return/^(TABLE|THEAD|TFOOT|TBODY|TR|UL|OL|DL)$/.test(c.parentNode.nodeName)||c.nodeValue==""||($.trim(c.nodeValue).length==0&&!(c.nextSibling&&c.previousSibling&&c.nextSibling.nodeType==1&&c.previousSibling.nodeType==1&&!this.regExp.block.test(c.nextSibling.nodeName)&&!this.regExp.block.test(c.previousSibling.nodeName)))}}return true};this.next=function(c){while(c.nextSibling&&(c=c.nextSibling)){if(c.nodeType==1||(c.nodeType==3&&!this.isEmpty(c))){return c}}return null};this.prev=function(c){while(c.previousSibling&&(c=c.previousSibling)){if(c.nodeType==1||(c.nodeType==3&&!this.isEmpty(c))){return c}}return null};this.isPrev=function(d,c){while((d=this.prev(d))){if(d==c){return true}}return false};this.nextAll=function(d){var c=[];while((d=this.next(d))){c.push(d)}return c};this.prevAll=function(d){var c=[];while((d=this.prev(d))){c.push(d)}return c};this.toLineEnd=function(d){var c=[];while((d=this.next(d))&&d.nodeName!="BR"&&d.nodeName!="HR"&&this.isInline(d)){c.push(d)}return c};this.toLineStart=function(d){var c=[];while((d=this.prev(d))&&d.nodeName!="BR"&&d.nodeName!="HR"&&this.isInline(d)){c.unshift(d)}return c};this.isFirstNotEmpty=function(c){while((c=this.prev(c))){if(c.nodeType==1||(c.nodeType==3&&$.trim(c.nodeValue)!="")){return false}}return true};this.isLastNotEmpty=function(c){while((c=this.next(c))){if(!this.isEmpty(c)){return false}}return true};this.isOnlyNotEmpty=function(c){return this.isFirstNotEmpty(c)&&this.isLastNotEmpty(c)};this.findLastNotEmpty=function(c){this.rte.log("findLastNotEmpty Who is here 0_o");if(c.nodeType==1&&(l=c.lastChild)){if(!this.isEmpty(l)){return l}while(l.previousSibling&&(l=l.previousSibling)){if(!this.isEmpty(l)){return l}}}return false};this.isInline=function(g){if(g.nodeType==3){return true}else{if(g.nodeType==1){g=$(g);var e=g.css("display");var c=g.css("float");return e=="inline"||e=="inline-block"||c=="left"||c=="right"}}return true};this.filter=function(f,e){e=this.regExp[e]||e;if(!f.push){return f.nodeName&&e.test(f.nodeName)?f:null}var c=[];for(var d=0;d<f.length;d++){if(f[d].nodeName&&f[d].nodeName&&e.test(f[d].nodeName)){c.push(f[d])}}return c};this.parents=function(e,d){var c=[];d=d=="*"?/.?/:(this.regExp[d]||d);d=this.regExp[d]||d;while(e&&(e=e.parentNode)&&e.nodeName!="BODY"&&e.nodeName!="HTML"){if(d.test(e.nodeName)){c.push(e)}}return c};this.parent=function(d,c){return this.parents(d,c)[0]||null};this.selfOrParent=function(e,d,c){return this.filter(e,d)||this.parent(e,c||d)};this.selfOrParentLink=function(c){c=this.selfOrParent(c,/^A$/);return c&&c.href?c:null};this.selfOrParentAnchor=function(c){c=this.selfOrParent(c,/^A$/);return c&&!c.href&&c.name?c:null};this.childLinks=function(d){var c=[];$("a[href]",d).each(function(){c.push(this)});return c};this.wrap=function(d,c){d=d.length?d:[d];c=c.nodeName?c:this.create(c);c=d[0].parentNode.insertBefore(c,d[0]);$(d).each(function(){if(this!=c){c.appendChild(this)}});return c};this.wrapContents=function(e,c){c=c.nodeName?c:this.create(c);for(var d=0;d<e.childNodes.length;d++){c.appendChild(e.childNodes[d])}e.appendChild(c);return c};this.cleanNode=function(c){if(c.nodeType!=1){return}if(/^(P|LI)$/.test(c.nodeName)&&(l=this.findLastNotEmpty(c))&&l.nodeName=="BR"){$(l).remove()}$n=$(c);$n.children().each(function(){this.cleanNode(this)});if(c.nodeName!="BODY"&&!/^(TABLE|TR|TD)$/.test(c)&&this.isEmpty(c)){return $n.remove()}if($n.attr("style")===""){$n.removeAttr("style")}if(this.rte.browser.safari&&$n.hasClass("Apple-span")){$n.removeClass("Apple-span")}if(c.nodeName=="SPAN"&&!$n.attr("style")&&!$n.attr("class")&&!$n.attr("id")){$n.replaceWith($n.html())}};this.cleanChildNodes=function(d){var c=this.cleanNode;$(d).children().each(function(){c(this)})};this.tableMatrix=function(f){var e=[];if(f&&f.nodeName=="TABLE"){var d=0;function c(h){for(var g=0;g<=d;g++){if(!e[h][g]){return g}}}$(f).find("tr").each(function(g){if(!$.isArray(e[g])){e[g]=[]}$(this).children("td,th").each(function(){var k=parseInt($(this).attr("colspan")||1);var q=parseInt($(this).attr("rowspan")||1);var p=c(g);for(var s=0;s<q;s++){for(var j=0;j<k;j++){var o=g+s;if(!$.isArray(e[o])){e[o]=[]}var r=j==0&&s==0?this:(s==0?j:"-");e[o][p+j]=r}}d=Math.max(d,e[g].length)})})}return e};this.indexesOfCell=function(f,e){for(var c=0;c<e.length;c++){for(var d=0;d<e[c].length;d++){if(e[c][d]==f){return[c,d]}}}};this.fixTable=function(k){if(k&&k.nodeName=="TABLE"){var e=$(k);var j=this.tableMatrix(k);var c=0;$.each(j,function(){c=Math.max(c,this.length)});if(c==0){return e.remove()}for(var g=0;g<j.length;g++){var d=j[g].length;if(d==0){e.find("tr").eq(g).remove()}else{if(d<c){var f=c-d;var h=e.find("tr").eq(g);for(i=0;i<f;i++){h.append("<td>&nbsp;</td>")}}}}}};this.tableColumn=function(f,e,j){f=this.selfOrParent(f,/^TD|TH$/);var g=this.selfOrParent(f,/^TABLE$/);ret=[];info={offset:[],delta:[]};if(f&&g){j&&this.fixTable(g);var q=this.tableMatrix(g);var s=false;var p;for(var c=0;c<q.length;c++){for(var o=0;o<q[c].length;o++){if(q[c][o]==f){p=o;s=true;break}}if(s){break}}if(p>=0){for(var c=0;c<q.length;c++){var h=q[c][p]||null;if(h){if(h.nodeName){ret.push(h);if(e){info.delta.push(0);info.offset.push(p)}}else{var k=parseInt(h);if(!isNaN(k)&&q[c][p-k]&&q[c][p-k].nodeName){ret.push(q[c][p-k]);if(e){info.delta.push(k);info.offset.push(p)}}}}}}}return !e?ret:{column:ret,info:info}}};elRTE.prototype.options={doctype:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">',cssClass:"el-rte",cssfiles:[],height:null,lang:"en",toolbar:"normal",absoluteURLs:true,allowSource:true,stripWhiteSpace:false,styleWithCSS:false,fmAllow:true,fmOpen:null,buttons:{save:"Save",copy:"Copy",cut:"Cut",paste:"Paste",pastetext:"Paste only text",pasteformattext:"Paste formatted text",removeformat:"Clean format",undo:"Undo last action",redo:"Redo previous action",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",superscript:"Superscript",subscript:"Subscript",justifyleft:"Align left",justifyright:"Ailgn right",justifycenter:"Align center",justifyfull:"Align full",indent:"Indent",outdent:"Outdent",forecolor:"Font color",hilitecolor:"Background color",formatblock:"Format",fontsize:"Font size",fontname:"Font",insertorderedlist:"Ordered list",insertunorderedlist:"Unordered list",horizontalrule:"Horizontal rule",blockquote:"Blockquote",div:"Block element (DIV)",link:"Link",unlink:"Delete link",anchor:"Bookmark",image:"Image",table:"Table",tablerm:"Delete table",tableprops:"Table properties",tbcellprops:"Table cell properties",tbrowbefore:"Insert row before",tbrowafter:"Insert row after",tbrowrm:"Delete row",tbcolbefore:"Insert column before",tbcolafter:"Insert column after",tbcolrm:"Delete column",tbcellsmerge:"Merge table cells",tbcellsplit:"Split table cell",docstructure:"Toggle display document structure",elfinder:"Open file manager",fullscreen:"Toggle full screen mode",nbsp:"Non breakable space",stopfloat:"Stop element floating"},panels:{save:["save"],copypaste:["copy","cut","paste","pastetext","pasteformattext","removeformat","docstructure"],undoredo:["undo","redo"],style:["bold","italic","underline","strikethrough","subscript","superscript"],colors:["forecolor","hilitecolor"],alignment:["justifyleft","justifycenter","justifyright","justifyfull"],indent:["outdent","indent"],format:["formatblock","fontsize","fontname"],lists:["insertorderedlist","insertunorderedlist"],elements:["horizontalrule","blockquote","div","stopfloat","nbsp"],links:["link","unlink","anchor"],images:["image"],media:["image"],tables:["table","tableprops","tablerm","tbrowbefore","tbrowafter","tbrowrm","tbcolbefore","tbcolafter","tbcolrm","tbcellprops","tbcellsmerge","tbcellsplit"],elfinder:["elfinder"],fullscreen:["fullscreen"]},toolbars:{tiny:["style"],compact:["save","undoredo","style","alignment","lists","links","fullscreen"],normal:["save","copypaste","undoredo","style","alignment","colors","indent","lists","links","elements","images","fullscreen"],complite:["save","copypaste","undoredo","style","alignment","colors","format","indent","lists","links","elements","media","fullscreen"],maxi:["save","copypaste","undoredo","style","alignment","colors","format","indent","lists","links","elements","media","tables","fullscreen"],eldorado:["save","copypaste","elfinder","undoredo","style","alignment","colors","format","indent","lists","links","elements","media","tables","fullscreen"]},panelNames:{save:"Save",copypaste:"Copy/Pase",undoredo:"Undo/Redo",style:"Text styles",colors:"Colors",alignment:"Alignment",indent:"Indent/Outdent",format:"Text format",lists:"Lists",elements:"Misc elements",links:"Links",images:"Images",media:"Media",tables:"Tables",elfinder:"File manager (elFinder)"}};elRTE.prototype.selection=function(d){this.rte=d;var b=this;this.w3cRange=null;var h,a,f,g;$(this.rte.doc).keyup(function(j){if(j.ctrlKey||j.metaKey||(j.keyCode>=8&&j.keyCode<=13)||(j.keyCode>=32&&j.keyCode<=40)||j.keyCode==46||(j.keyCode>=96&&j.keyCode<=111)){b.cleanCache()}}).mousedown(function(j){if(j.target.nodeName=="HTML"){h=b.rte.doc.body}else{h=j.target}a=f=null}).mouseup(function(j){if(j.target.nodeName=="HTML"){a=b.rte.doc.body}else{a=j.target}a=j.target;f=null}).click();function e(){return b.rte.window.getSelection?b.rte.window.getSelection():b.rte.window.document.selection}function c(o,k,j){while(o.nodeName!="BODY"&&o.parentNode&&o.parentNode.nodeName!="BODY"&&(k?o!==k&&o.parentNode!=k:1)&&((j=="left"&&b.rte.dom.isFirstNotEmpty(o))||(j=="right"&&b.rte.dom.isLastNotEmpty(o))||(b.rte.dom.isFirstNotEmpty(o)&&b.rte.dom.isLastNotEmpty(o)))){o=o.parentNode}return o}this.collapsed=function(){return this.getRangeAt().isCollapsed()};this.collapse=function(j){this.getRangeAt().collapse(j?true:false)};this.getRangeAt=function(o){if(this.rte.browser.msie){if(!this.w3cRange){this.w3cRange=new this.rte.w3cRange(this.rte)}o&&this.w3cRange.update();return this.w3cRange}var j=e();var k=j.rangeCount>0?j.getRangeAt(0):this.rte.doc.createRange();k.getStart=function(){return this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(this.startOffset,this.startContainer.childNodes.length-1)]:this.startContainer};k.getEnd=function(){return this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(this.startOffset==this.endOffset?this.endOffset:this.endOffset-1,this.endContainer.childNodes.length-1)]:this.endContainer};k.isCollapsed=function(){return this.collapsed};return k};this.saveIERange=function(){if($.browser.msie){g=this.getRangeAt().getBookmark()}};this.restoreIERange=function(){$.browser.msie&&g&&this.getRangeAt().moveToBookmark(g)};this.select=function(j,o){o=o||j;var k=this.getRangeAt();k.setStartBefore(j);k.setEndAfter(o);if(this.rte.browser.msie){k.select()}else{var j=e();j.removeAllRanges();j.addRange(k)}return this.cleanCache()};this.selectContents=function(p){var k=this.getRangeAt();if(p&&p.nodeType==1){if(this.rte.browser.msie){k.range();k.r.moveToElementText(p.parentNode);k.r.select()}else{try{k.selectNodeContents(p)}catch(o){return this.rte.log("unable select node contents "+p)}var j=e();j.removeAllRanges();j.addRange(k)}}return this};this.insertNode=function(q,p){if(p&&!this.collapsed()){this.collapse()}if(this.rte.browser.msie){var j=q.nodeType==3?q.nodeValue:$(this.rte.dom.create("span")).append($(q)).html();var o=this.getRangeAt();o.insertNode(j)}else{var o=this.getRangeAt();o.insertNode(q);o.setStartAfter(q);o.setEndAfter(q);var k=e();k.removeAllRanges();k.addRange(o)}return this.cleanCache()};this.insertHtml=function(j,k){if(k&&!this.collapsed()){this.collapse()}if(this.rte.browser.msie){this.getRangeAt().range().pasteHTML(j)}else{var o=$(this.rte.dom.create("span")).html(j||"").get(0);this.insertNode(o);$(o).replaceWith($(o).html())}return this.cleanCache()};this.insertText=function(k,j){var o=this.rte.doc.createTextNode(k);return this.insertHtml(o.nodeValue)};this.cleanCache=function(){h=a=f=null;return this};this.getStart=function(){if(!h){var j=this.getRangeAt();h=j.getStart()}return h};this.getEnd=function(){if(!a){var j=this.getRangeAt();a=j.getEnd()}return a};this.getNode=function(){if(!f){f=this.rte.dom.findCommonAncestor(this.getStart(),this.getEnd())}return f};this.selected=function(p){var j={collapsed:false,blocks:false,filter:false,wrap:"text",tag:"span"};j=$.extend({},j,p);if(j.blocks){var s=this.getNode(),r=null;if(r=this.rte.dom.selfOrParent(s,"selectionBlock")){return[r]}}var q=this.selectedRaw(j.collapsed,j.blocks);var w=[];var t=[];var x=null;function k(){function z(){for(var B=0;B<t.length;B++){if(t[B].nodeType==1&&(b.rte.dom.selfOrParent(t[B],/^P$/)||$(t[B]).find("p").length>0)){return false}}return true}if(t.length>0){var o=j.tag=="p"&&!z()?"div":j.tag;var A=b.rte.dom.wrap(t,o);w[x]=A;x=null;t=[]}}function v(A){if(A.nodeType==1){if(/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(A.nodeName)){$(A).find("td,th").each(function(){var B=j.tag=="p"&&$(this).find("p").length>0?"div":j.tag;var C=b.rte.dom.wrapContents(this,B);return w.push(C)})}else{if(/^(CAPTION|TD|TH|LI|DT|DD)$/.test(A.nodeName)){var o=j.tag=="p"&&$(A).find("p").length>0?"div":j.tag;var A=b.rte.dom.wrapContents(A,o);return w.push(A)}}}var z=t.length>0?t[t.length-1]:null;if(z&&z!=b.rte.dom.prev(A)){k()}t.push(A);if(x===null){x=w.length;w.push("dummy")}}if(q.nodes.length>0){for(var u=0;u<q.nodes.length;u++){var s=q.nodes[u];if(s.nodeType==3&&(u==0||u==q.nodes.length-1)&&$.trim(s.nodeValue).length>0){if(u==0&&q.so>0){s=s.splitText(q.so)}if(u==q.nodes.length-1&&q.eo>0){s.splitText(u==0&&q.so>0?q.eo-q.so:q.eo)}}switch(j.wrap){case"text":if((s.nodeType==1&&s.nodeName=="BR")||(s.nodeType==3&&$.trim(s.nodeValue).length>0)){v(s)}else{if(s.nodeType==1){w.push(s)}}break;case"inline":if(this.rte.dom.isInline(s)){v(s)}else{if(s.nodeType==1){w.push(s)}}break;case"all":if(s.nodeType==1||!this.rte.dom.isEmpty(s)){v(s)}break;default:if(s.nodeType==1||!this.rte.dom.isEmpty(s)){w.push(s)}}}k()}return j.filter?this.rte.dom.filter(w,j.filter):w};this.dump=function(j,o,t,q,k){var p=this.getRangeAt();this.rte.log("commonAncestorContainer");this.rte.log(j||p.commonAncestorContainer);this.rte.log("startContainer");this.rte.log(o||p.startContainer);this.rte.log("startOffset: "+(q>=0?q:p.startOffset));this.rte.log("endContainer");this.rte.log(t||p.endContainer);this.rte.log("endOffset: "+(k>=0?k:p.endOffset))};this.selectedRaw=function(v,j){var C={so:null,eo:null,nodes:[]};var k=this.getRangeAt(true);var t=k.commonAncestorContainer;var E,B;var A=false;var x=false;function z(G,r,F){if(G.nodeType==3){F=F>=0?F:G.nodeValue.length;return(r==0&&F==G.nodeValue.length)||$.trim(G.nodeValue).length==$.trim(G.nodeValue.substring(r,F)).length}return true}function u(G,r,F){if(G.nodeType==1){return b.rte.dom.isEmpty(G)}else{if(G.nodeType==3){return $.trim(G.nodeValue.substring(r||0,F>=0?F:G.nodeValue.length)).length==0}}return true}if(k.startContainer.nodeType==1){if(k.startOffset<k.startContainer.childNodes.length){E=k.startContainer.childNodes[k.startOffset];C.so=E.nodeType==1?null:0}else{E=k.startContainer.childNodes[k.startOffset-1];C.so=E.nodeType==1?null:E.nodeValue.length}}else{E=k.startContainer;C.so=k.startOffset}if(k.collapsed){if(v){if(j){E=c(E);if(!this.rte.dom.isEmpty(E)||(E=this.rte.dom.next(E))){C.nodes=[E]}if(this.rte.dom.isInline(E)){C.nodes=this.rte.dom.toLineStart(E).concat(C.nodes,this.rte.dom.toLineEnd(E))}if(C.nodes.length>0){C.so=C.nodes[0].nodeType==1?null:0;C.eo=C.nodes[C.nodes.length-1].nodeType==1?null:C.nodes[C.nodes.length-1].nodeValue.length}}else{if(!this.rte.dom.isEmpty(E)){C.nodes=[E]}}}return C}if(k.endContainer.nodeType==1){B=k.endContainer.childNodes[k.endOffset-1];C.eo=B.nodeType==1?null:B.nodeValue.length}else{B=k.endContainer;C.eo=k.endOffset}if(E.nodeType==1||j||z(E,C.so,E.nodeValue.length)){E=c(E,t,"left");A=true;C.so=E.nodeType==1?null:0}if(B.nodeType==1||j||z(B,0,C.eo)){B=c(B,t,"right");x=true;C.eo=B.nodeType==1?null:B.nodeValue.length}if(j){if(E.nodeType!=1&&E.parentNode!=t&&E.parentNode.nodeName!="BODY"){E=E.parentNode;C.so=null}if(B.nodeType!=1&&B.parentNode!=t&&B.parentNode.nodeName!="BODY"){B=B.parentNode;C.eo=null}}if(E.parentNode==B.parentNode&&E.parentNode.nodeName!="BODY"&&(A&&this.rte.dom.isFirstNotEmpty(E))&&(x&&this.rte.dom.isLastNotEmpty(B))){E=B=E.parentNode;C.so=E.nodeType==1?null:0;C.eo=B.nodeType==1?null:B.nodeValue.length}if(E==B){if(!this.rte.dom.isEmpty(E)){C.nodes.push(E)}return C}var o=E;while(o.nodeName!="BODY"&&o.parentNode!==t&&o.parentNode.nodeName!="BODY"){o=o.parentNode}var D=B;while(D.nodeName!="BODY"&&D.parentNode!==t&&D.parentNode.nodeName!="BODY"){this.rte.log(D);D=D.parentNode}if(!u(E,C.so,E.nodeType==3?E.nodeValue.length:null)){C.nodes.push(E)}var q=E;while(q!==o){var p=q;while((p=this.rte.dom.next(p))){C.nodes.push(p)}q=q.parentNode}q=o;while((q=this.rte.dom.next(q))&&q!=D){C.nodes.push(q)}var w=[];q=B;while(q!==D){var p=q;while((p=this.rte.dom.prev(p))){w.push(p)}q=q.parentNode}if(w.length){C.nodes=C.nodes.concat(w.reverse())}if(!u(B,0,B.nodeType==3?C.eo:null)){C.nodes.push(B)}if(j){if(this.rte.dom.isInline(E)){C.nodes=this.rte.dom.toLineStart(E).concat(C.nodes);C.so=C.nodes[0].nodeType==1?null:0}if(this.rte.dom.isInline(B)){C.nodes=C.nodes.concat(this.rte.dom.toLineEnd(B));C.eo=C.nodes[C.nodes.length-1].nodeType==1?null:C.nodes[C.nodes.length-1].nodeValue.length}}return C}};elRTE.prototype.ui=function(a){var r=this;this.rte=a;this._buttons=[];for(var h in this.buttons){if(h!="button"){this.buttons[h].prototype=this.buttons.button.prototype}}var q=a.options.toolbar&&a.options.toolbars[a.options.toolbar]?a.options.toolbar:"normal";var k=this.rte.options.toolbars[q];for(var h in k){var e=k[h];var d=$("<ul />").addClass("panel-".name).appendTo(this.rte.toolbar);if(h==0){d.addClass("first")}for(var g in this.rte.options.panels[e]){var f=this.rte.options.panels[e][g];var o=this.buttons[f]||this.buttons.button;var p=new o(this.rte,f);d.append(p.domElem);this._buttons.push(p)}}this.rte.tabsbar.children(".tab").click(function(b){if(!$(b.currentTarget).hasClass("active")){r.rte.tabsbar.children(".tab").toggleClass("active");r.rte.workzone.children().toggle();if($(b.currentTarget).hasClass("editor")){r.rte.updateEditor()}else{r.rte.updateSource();$.each(r._buttons,function(){!this.active&&this.domElem.addClass("disabled")});r.rte.source.focus()}}});this.update()};elRTE.prototype.ui.prototype.update=function(a){a&&this.rte.selection.cleanCache();var d=this.rte.selection.getNode();var c=this.rte.dom.parents(d,"*");var b="";if(c.length){$.each(c.reverse(),function(){b+=" &raquo; "+this.nodeName.toLowerCase()})}if(d.nodeType==1&&d.nodeName!="BODY"){b+=" &raquo; "+d.nodeName.toLowerCase()}this.rte.statusbar.html(b);$.each(this._buttons,function(){this.update()});this.rte.window.focus()};elRTE.prototype.ui.prototype.buttons={button:function(c,b){var a=this;this.rte=c;this.active=false;this.name=b;this.val=null;this.domElem=$("<li />").addClass(b+" rounded-3").attr({name:b,title:this.rte.i18n(this.rte.options.buttons[b]||b),unselectable:"on"}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(d){d.stopPropagation();d.preventDefault();if(!$(this).hasClass("disabled")){a.command()}})}};elRTE.prototype.ui.prototype.buttons.button.prototype.command=function(){try{this.rte.doc.execCommand(this.name,false,this.val)}catch(a){this.rte.log("commands failed: "+this.name)}this.rte.ui.update(true)};elRTE.prototype.ui.prototype.buttons.button.prototype.update=function(){try{if(!this.rte.doc.queryCommandEnabled(this.name)){return this.domElem.addClass("disabled")}else{this.domElem.removeClass("disabled")}}catch(a){return}try{if(this.rte.doc.queryCommandState(this.name)){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}}catch(a){}};elRTE.prototype.utils=function(b){this.rte=b;this.url=null;this.reg=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;this.baseURL="";this.path="";var a=this;this.rgb2hex=function(e){function d(f){hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return !f?"00":hexDigits[(f-f%16)/16]+hexDigits[f%16]}var c=e.match(/\(([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})\)/);return c?"#"+d(c[1])+d(c[2])+d(c[3]):""};this.toPixels=function(d){var c=d.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);if(c){d=c[1];unit=c[2]}if(d[0]=="."){d="0"+d}d=parseFloat(d);if(isNaN(d)){return""}var e=parseInt($(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(d*e);case"pt":return parseInt(d*e/12);case"%":return parseInt(d*e/100)}return d};this.absoluteURL=function(d){!this.url&&this._url();d=$.trim(d);if(!d){return""}if(d[0]=="#"){return d}var c=this.parseURL(d);if(!c.host&&!c.path&&!c.anchor){return""}if(!this.rte.options.absoluteURLs){return d}if(c.protocol){return d}if(c.host&&(c.host.indexOf(".")!=-1||c.host=="localhost")){return this.url.protocol+"://"+d}if(d[0]=="/"){d=this.baseURL+d}else{if(d.indexOf("./")==0){d=d.substring(2)}d=this.baseURL+this.path+d}return d};this.parseURL=function(e){var d=e.match(this.reg);var c={};$.each(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(f){c[this]=d[f]});if(!c.host.match(/[a-z0-9]/i)){c.host=""}return c};this.trimEventCallback=function(d){d=d?d.toString():"";return $.trim(d.replace(/\r*\n/mg,"").replace(/^function\s*on[a-z]+\s*\(\s*event\s*\)\s*\{(.+)\}$/igm,"$1"))};this._url=function(){this.url=this.parseURL(window.location.href);this.baseURL=this.url.protocol+"://"+(this.url.userInfo?parts.userInfo+"@":"")+this.url.host+(this.url.port?":"+this.url.port:"");this.path=!this.url.file?this.url.path:this.url.path.substring(0,this.url.path.length-this.url.file.length)}};elRTE.prototype.w3cRange=function(b){var a=this;this.rte=b;this.r=null;this.collapsed=true;this.startContainer=null;this.endContainer=null;this.startOffset=0;this.endOffset=0;this.commonAncestorContainer=null;this.range=function(){try{this.r=this.rte.window.document.selection.createRange()}catch(c){this.r=this.rte.doc.body.createTextRange()}return this.r};this.insertNode=function(c){this.range();a.r.collapse(false);var d=a.r.duplicate();d.pasteHTML(c)};this.getBookmark=function(){this.range();if(this.r.item){var c=this.r.item(0);this.r=this.rte.doc.body.createTextRange();this.r.moveToElementText(c)}return this.r.getBookmark()};this.moveToBookmark=function(c){this.rte.window.focus();this.range().moveToBookmark(c);this.r.select()};this.update=function(){function e(t){var g="\uFEFF";var h=offset=0;var k=a.r.duplicate();k.collapse(t);var o=k.parentElement();if(!o||o.nodeName=="HTML"){return{parent:a.rte.doc.body,ndx:h,offset:offset}}k.pasteHTML(g);childs=o.childNodes;for(var j=0;j<childs.length;j++){var s=childs[j];if(j>0&&(s.nodeType!==3||childs[j-1].nodeType!==3)){h++}if(s.nodeType!==3){offset=0}else{var q=s.nodeValue.indexOf(g);if(q!==-1){offset+=q;break}offset+=s.nodeValue.length}}k.moveStart("character",-1);k.text="";return{parent:o,ndx:Math.min(h,o.childNodes.length-1),offset:offset}}this.range();this.startContainer=this.endContainer=null;if(this.r.item){this.collapsed=false;var d=this.r.item(0);this.setStart(d.parentNode,this.rte.dom.indexOf(d));this.setEnd(d.parentNode,this.startOffset+1)}else{this.collapsed=this.r.boundingWidth==0;var f=e(true);var c=e(false);f.parent.normalize();c.parent.normalize();f.ndx=Math.min(f.ndx,f.parent.childNodes.length-1);c.ndx=Math.min(c.ndx,c.parent.childNodes.length-1);if(f.parent.childNodes[f.ndx].nodeType&&f.parent.childNodes[f.ndx].nodeType==1){this.setStart(f.parent,f.ndx)}else{this.setStart(f.parent.childNodes[f.ndx],f.offset)}if(c.parent.childNodes[c.ndx].nodeType&&c.parent.childNodes[c.ndx].nodeType==1){this.setEnd(c.parent,c.ndx)}else{this.setEnd(c.parent.childNodes[c.ndx],c.offset)}this.select()}return this};this.isCollapsed=function(){this.range();this.collapsed=this.r.item?false:this.r.boundingWidth==0;return this.collapsed};this.collapse=function(c){this.range();if(this.r.item){var d=this.r.item(0);this.r=this.rte.doc.body.createTextRange();this.r.moveToElementText(d)}this.r.collapse(c);this.r.select();this.collapsed=true};this.getStart=function(){this.range();if(this.r.item){return this.r.item(0)}var d=this.r.duplicate();d.collapse(true);var c=d.parentElement();return c&&c.nodeName=="BODY"?c.firstChild:c};this.getEnd=function(){this.range();if(this.r.item){return this.r.item(0)}var c=this.r.duplicate();c.collapse(false);var d=c.parentElement();return d&&d.nodeName=="BODY"?d.lastChild:d};this.setStart=function(c,d){this.startContainer=c;this.startOffset=d;if(this.endContainer){this.commonAncestorContainer=this.rte.dom.findCommonAncestor(this.startContainer,this.endContainer)}};this.setEnd=function(c,d){this.endContainer=c;this.endOffset=d;if(this.startContainer){this.commonAncestorContainer=this.rte.dom.findCommonAncestor(this.startContainer,this.endContainer)}};this.setStartBefore=function(c){if(c.parentNode){this.setStart(c.parentNode,this.rte.dom.indexOf(c))}};this.setStartAfter=function(c){if(c.parentNode){this.setStart(c.parentNode,this.rte.dom.indexOf(c)+1)}};this.setEndBefore=function(c){if(c.parentNode){this.setEnd(c.parentNode,this.rte.dom.indexOf(c))}};this.setEndAfter=function(c){if(c.parentNode){this.setEnd(c.parentNode,this.rte.dom.indexOf(c)+1)}};this.select=function(){function j(w,u){if(w.nodeType!=3){return -1}var v="\uFEFF";var t=w.nodeValue;var e=a.rte.doc.body.createTextRange();w.nodeValue=t.substring(0,u)+v+t.substring(u);e.moveToElementText(w.parentNode);e.findText(v);var s=Math.abs(e.moveStart("character",-1048575));w.nodeValue=t;return s}this.r=this.rte.doc.body.createTextRange();var h=this.startOffset;var d=this.endOffset;var q=this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(h,this.startContainer.childNodes.length-1)]:this.startContainer;var k=this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(h==d?d:d-1,this.endContainer.childNodes.length-1)]:this.endContainer;if(this.collapsed){if(q.nodeType==3){var f=j(q,h);this.r.move("character",f)}else{this.r.moveToElementText(q);this.r.collapse(true)}}else{var c=this.rte.doc.body.createTextRange();var g=j(q,h);var o=j(k,d);if(q.nodeType==3){this.r.move("character",g)}else{this.r.moveToElementText(q)}if(k.nodeType==3){c.move("character",o)}else{c.moveToElementText(k)}this.r.setEndPoint("EndToEnd",c)}try{this.r.select()}catch(k){}if(c){c=null}};this.dump=function(){this.rte.log("collapsed: "+this.collapsed);this.rte.log("startContainer: "+(this.startContainer?this.startContainer.nodeName:"non"));this.rte.log("startOffset: "+this.startOffset);this.rte.log("endContainer: "+(this.endContainer?this.endContainer.nodeName:"none"));this.rte.log("endOffset: "+this.endOffset)}};elRTE.prototype.ui.prototype.buttons.anchor=function(c,b){this.constructor.prototype.constructor.call(this,c,b);this.input=$('<input type="text" />').attr("name","anchor").attr("size","16");var a=this;this.command=function(){var e={submit:function(g,h){g.stopPropagation();g.preventDefault();h.close();a.set()},dialog:{title:this.rte.i18n("Bookmark")}};this.anchor=this.rte.dom.selfOrParentAnchor(this.rte.selection.getEnd())||c.dom.create("a");!this.rte.selection.collapsed()&&this.rte.selection.collapse(false);this.input.val($(this.anchor).addClass("el-rte-anchor").attr("name"));this.rte.selection.saveIERange();var f=new elDialogForm(e);f.append([this.rte.i18n("Bookmark name"),this.input],null,true).open()};this.update=function(){var d=this.rte.selection.getNode();if(this.rte.dom.selfOrParentLink(d)){this.domElem.addClass("disabled")}else{if(this.rte.dom.selfOrParentAnchor(d)){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.removeClass("disabled").removeClass("active")}}};this.set=function(){var d=$.trim(this.input.val());this.rte.selection.restoreIERange();this.rte.log(this.anchor.parentNode);if(d){if(!this.anchor.parentNode){this.rte.selection.insertHtml('<a name="'+d+'" title="'+this.rte.i18n("Bookmark")+": "+d+'" class="el-rte-anchor"></a>')}else{this.anchor.name=d;this.anchor.title=this.rte.i18n("Bookmark")+": "+d}}else{if(this.anchor.parentNode){this.anchor.parentNode.removeChild(this.anchor)}}}};elRTE.prototype.ui.prototype.buttons.blockquote=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){var d,c;if(this.rte.selection.collapsed()&&(d=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^BLOCKQUOTE$/))){$(d).replaceWith($(d).html())}else{c=this.rte.selection.selected({wrap:"all",tag:"blockquote"});c.length&&this.rte.selection.select(c[0],c[c.length-1])}this.rte.ui.update(true)};this.update=function(){if(this.rte.selection.collapsed()){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^BLOCKQUOTE$/)){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.addClass("disabled").removeClass("active")}}else{this.domElem.removeClass("disabled").removeClass("active")}}};elRTE.prototype.ui.prototype.buttons.copy=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){if(this.rte.browser.mozilla){try{this.rte.doc.execCommand(this.name,false,null)}catch(g){var c=" Ctl + C";if(this.name=="cut"){c=" Ctl + X"}else{if(this.name=="paste"){c=" Ctl + V"}}var f={dialog:{title:this.rte.i18n("Warning"),buttons:{Ok:function(){$(this).dialog("close")}}}};var h=new elDialogForm(f);h.append(this.rte.i18n("This operation is disabled in your browser on security reason. Use shortcut instead.")+": "+c).open()}}else{this.constructor.prototype.command.call(this)}}};elRTE.prototype.ui.prototype.buttons.cut=elRTE.prototype.ui.prototype.buttons.copy;elRTE.prototype.ui.prototype.buttons.paste=elRTE.prototype.ui.prototype.buttons.copy;elRTE.prototype.ui.prototype.buttons.div=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){var d,c;if(this.rte.selection.collapsed()&&(d=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^DIV$/))){$(d).replaceWith($(d).html())}else{c=this.rte.selection.selected({wrap:"all",tag:"div"});c.length&&this.rte.selection.select(c[0],c[c.length-1])}this.rte.ui.update(true)};this.update=function(){if(this.rte.selection.collapsed()){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^DIV$/)){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.addClass("disabled").removeClass("active")}}else{this.domElem.removeClass("disabled").removeClass("active")}}};elRTE.prototype.ui.prototype.buttons.docstructure=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){this.domElem.toggleClass("active");$(this.rte.doc.body).toggleClass("el-rte-structure")};this.command();this.update=function(){this.domElem.removeClass("disabled")}};elRTE.prototype.ui.prototype.buttons.elfinder=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.command=function(){if(a.rte.options.fmAllow&&typeof(a.rte.options.fmOpen)=="function"){a.rte.options.fmOpen(function(d){a.rte.log(d)})}};this.update=function(){if(a.rte.options.fmAllow&&typeof(a.rte.options.fmOpen)=="function"){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.fontname=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;var d={tpl:'<span style="font-family:%val">%label</span>',select:function(e){a.set(e)},src:{"":this.rte.i18n("Font"),"andale mono,sans-serif":"Andale Mono","arial,helvetica,sans-serif":"Arial","arial black,gadget,sans-serif":"Arial Black","book antiqua,palatino,sans-serif":"Book Antiqua","comic sans ms,cursive":"Comic Sans MS","courier new,courier,monospace":"Courier New","georgia,palatino,serif":"Georgia","helvetica,sans-serif":"Helvetica","impact,sans-serif":"Impact","lucida console,monaco,monospace":"Lucida console","lucida sans unicode,lucida grande,sans-serif":"Lucida grande","tahoma,sans-serif":"Tahoma","times new roman,times,serif":"Times New Roman","trebuchet ms,lucida grande,verdana,sans-serif":"Trebuchet MS","verdana,geneva,sans-serif":"Verdana"}};this.select=this.domElem.elSelect(d);this.command=function(){};this.set=function(f){var e=this.rte.selection.selected({filter:"textContainsNodes"});$.each(e,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?$(this).find("td,th"):$(this);$(this).css("font-family",f).find("[style]").css("font-family","")});this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");var f=this.rte.selection.getNode();if(f.nodeType!=1){f=f.parentNode}var e=$(f).css("font-family");e=e?e.toString().toLowerCase().replace(/,\s+/g,",").replace(/'|"/g,""):"";this.select.val(d.src[e]?e:"")}};elRTE.prototype.ui.prototype.buttons.fontsize=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;var d={labelTpl:"%label",tpl:'<span style="font-size:%val;line-height:1.2em">%label</span>',select:function(e){a.set(e)},src:{"":this.rte.i18n("Font size"),"xx-small":this.rte.i18n("Small (8pt)"),"x-small":this.rte.i18n("Small (10px)"),small:this.rte.i18n("Small (12pt)"),medium:this.rte.i18n("Normal (14pt)"),large:this.rte.i18n("Large (18pt)"),"x-large":this.rte.i18n("Large (24pt)"),"xx-large":this.rte.i18n("Large (36pt)")}};this.select=this.domElem.elSelect(d);this.command=function(){};this.set=function(f){var e=this.rte.selection.selected({filter:"textContainsNodes"});$.each(e,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?$(this).find("td,th"):$(this);$this.css("font-size",f).find("[style]").css("font-size","")});this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");var e=this.rte.selection.getNode();this.select.val((m=this.rte.dom.attr(e,"style").match(/font-size:\s*([^;]+)/i))?m[1]:"")}};elRTE.prototype.ui.prototype.buttons.forecolor=function(c,b){var a=this;this.constructor.prototype.constructor.call(this,c,b);var d={"class":"",color:this.defaultColor,update:function(e){a.indicator.css("background-color",e)},change:function(e){a.set(e)}};this.defaultColor=this.rte.utils.rgb2hex($(this.rte.doc.body).css(this.name=="forecolor"?"color":"background-color"));this.picker=this.domElem.elColorPicker(d);this.indicator=$("<div />").addClass("color-indicator").prependTo(this.domElem);this.command=function(){};this.set=function(g){if(!this.rte.selection.collapsed()){var e=this.rte.selection.selected({collapse:false,wrap:"text"});var f=this.name=="forecolor"?"color":"background-color";$.each(e,function(){if(/^(THEAD|TBODY|TFOOT|TR)$/.test(this.nodeName)){$(this).find("td,th").each(function(){$(this).css(f,g).find("*").css(f,"")})}else{$(this).css(f,g).find("*").css(f,"")}});this.rte.ui.update(true)}};this.update=function(){this.domElem.removeClass("disabled");var f=this.rte.selection.getNode();if(f.nodeType!=1){f=f.parentNode}var e=$(f).css(this.name=="forecolor"?"color":"background-color");this.picker.val(e&&e!="transparent"?this.rte.utils.rgb2hex(e):this.defaultColor)}};elRTE.prototype.ui.prototype.buttons.hilitecolor=elRTE.prototype.ui.prototype.buttons.forecolor;elRTE.prototype.ui.prototype.buttons.formatblock=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var e=this.rte.browser.msie?function(f){a.val=f;a.constructor.prototype.command.call(a)}:function(f){a.ieCommand(f)};var a=this;var d={labelTpl:"%label",tpls:{"":"%label"},select:function(f){a.formatBlock(f)},src:{span:this.rte.i18n("Format"),h1:this.rte.i18n("Heading 1"),h2:this.rte.i18n("Heading 2"),h3:this.rte.i18n("Heading 3"),h4:this.rte.i18n("Heading 4"),h5:this.rte.i18n("Heading 5"),h6:this.rte.i18n("Heading 6"),p:this.rte.i18n("Paragraph"),address:this.rte.i18n("Address"),pre:this.rte.i18n("Preformatted")}};this.select=this.domElem.elSelect(d);this.command=function(){};this.formatBlock=function(g){function j(r,o){function q(s){$(s).find("h1,h2,h3,h4,h5,h6,p,address,pre").each(function(){$(this).replaceWith($(this).html())})}if(/^(LI|DT|DD)$/.test(r.nodeName)){q(r);a.rte.dom.wrapContents(r,o)}else{if(/^(UL|OL|DL)$/.test(r.nodeName)){var p="";$(r).children().each(function(){q(this);p+=$(this).html()});$(r).replaceWith($(a.rte.dom.create(o)).html(p||""))}else{q(r);$(r).replaceWith($(a.rte.dom.create(o)).html($(r).html()))}}}tag=g=="span"?"":g.toUpperCase();var f=this.rte.selection.selected({collapsed:true,blocks:true,wrap:"inline",tag:"span"});for(var h=0;h<f.length;h++){var k=f[h];if(tag){if(/^(TABLE|THEAD|TBODY|TFOOT|TR)$/.test(k.nodeName)){$(k).find("td,th").each(function(){j(this,tag)})}else{j(k,tag)}}else{if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(k.nodeName)){$(k).replaceWith($(this.rte.dom.create("div")).html($(k).html()||""))}}}this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");var f=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(H[1-6]|P|ADDRESS|PRE)$/);this.select.val(f?f.nodeName.toLowerCase():"span")}};elRTE.prototype.ui.prototype.buttons.fullscreen=function(c,b){this.constructor.prototype.constructor.call(this,c,b);this.active=true;this.parents=[];this.height=0;var a=this;this.command=function(){if(this.rte.editor.hasClass("el-fullscreen")){for(var d=0;d<this.parents.length;d++){$(this.parents[d]).css("position","relative")}this.parents=[];this.rte.editor.removeClass("el-fullscreen");this.rte.workzone.height(this.height);this.domElem.removeClass("active")}else{this.parents=[];var f=this.rte.editor.parents().each(function(){if(this.nodeName!="BODY"&&this.name!="HTML"&&$(this).css("position")=="relative"){a.parents.push(this);$(this).css("position","static")}});this.height=this.rte.workzone.height();this.rte.editor.addClass("el-fullscreen");var e=parseInt(this.rte.editor.height()-this.rte.toolbar.height()-this.rte.statusbar.height()-this.rte.tabsbar.height()-17);e>0&&this.rte.workzone.height(e);this.domElem.addClass("active")}};this.update=function(){this.domElem.removeClass("disabled")}};elRTE.prototype.ui.prototype.buttons.horizontalrule=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.src={width:$('<input type="text" />').attr({name:"width",size:4}).css("text-align","right"),wunit:$("<select />").attr("name","wunit").append($("<option />").val("%").text("%")).append($("<option />").val("px").text("px")).val("%"),height:$('<input type="text" />').attr({name:"height",size:4}).css("text-align","right"),bg:$("<div />"),border:$("<div />"),"class":$('<input type="text" />').css("width","100%"),style:$('<input type="text" />').css("width","100%")};this.command=function(){this.src.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"});var h=this.rte.selection.getEnd();this.hr=h.nodeName=="HR"?$(h):$(c.doc.createElement("hr")).css({width:"100%",height:"1px"});this.src.border.elBorderSelect({styleHeight:73,value:this.hr});var e=this.hr.css("width")||this.hr.attr("width");this.src.width.val(parseInt(e)||100);this.src.wunit.val(e.indexOf("px")!=-1?"px":"%");this.src.height.val(this.rte.utils.toPixels(this.hr.css("height")||this.hr.attr("height"))||1);this.src.bg.val(this.rte.utils.rgb2hex(this.hr.css("background-color"))||"");this.src["class"].val(this.rte.dom.attr(this.hr,"class"));this.src.style.val(this.rte.dom.attr(this.hr,"style"));var f={submit:function(j,k){j.stopPropagation();j.preventDefault();a.set();k.close()},dialog:{title:this.rte.i18n("Horizontal rule")}};var g=new elDialogForm(f);g.append([this.rte.i18n("Width"),$("<span />").append(this.src.width).append(this.src.wunit)],null,true).append([this.rte.i18n("Height"),$("<span />").append(this.src.height).append(" px")],null,true).append([this.rte.i18n("Border"),this.src.border],null,true).append([this.rte.i18n("Background"),this.src.bg],null,true).append([this.rte.i18n("Css class"),this.src["class"]],null,true).append([this.rte.i18n("Css style"),this.src.style],null,true).open()};this.update=function(){this.domElem.removeClass("disabled");if(this.rte.selection.getEnd().nodeName=="HR"){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}};this.set=function(){!this.hr.parentNode&&this.rte.selection.insertNode(this.hr.get(0));var e={noshade:true,style:this.src.style.val()};var d=this.src.border.val();var f={width:(parseInt(this.src.width.val())||100)+this.src.wunit.val(),height:parseInt(this.src.height.val())||1,"background-color":this.src.bg.val(),border:d.width&&d.style?d.width+" "+d.style+" "+d.color:""};this.hr.removeAttr("class").removeAttr("style").removeAttr("width").removeAttr("height").removeAttr("align").attr(e).css(f);if(this.src["class"].val()){this.hr.attr("class",this.src["class"].val())}}};elRTE.prototype.ui.prototype.buttons.image=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.img=null;this.init=function(){this.labels={main:"Properies",link:"Link",adv:"Advanced",events:"Events",id:"ID","class":"Css class",style:"Css style",longdesc:"Detail description URL",href:"URL",target:"Open in",title:"Title"};this.src={main:{src:$('<input type="text" />').css("width","100%"),title:$('<input type="text" />').css("width","100%"),alt:$('<input type="text" />').css("width","100%"),width:$('<input type="text" />').attr("size",5).css("text-align","right"),height:$('<input type="text" />').attr("size",5).css("text-align","right"),margin:$("<div />"),align:$("<select />").css("width","100%").append($("<option />").val("").text(this.rte.i18n("Not set","dialogs"))).append($("<option />").val("left").text(this.rte.i18n("Left"))).append($("<option />").val("right").text(this.rte.i18n("Right"))).append($("<option />").val("top").text(this.rte.i18n("Top"))).append($("<option />").val("text-top").text(this.rte.i18n("Text top"))).append($("<option />").val("middle").text(this.rte.i18n("middle"))).append($("<option />").val("baseline").text(this.rte.i18n("Baseline"))).append($("<option />").val("bottom").text(this.rte.i18n("Bottom"))).append($("<option />").val("text-bottom").text(this.rte.i18n("Text bottom"))),border:$("<div />")},adv:{id:$('<input type="text" />').css("width","100%"),"class":$('<input type="text" />').css("width","100%"),style:$('<input type="text" />').css("width","100%"),longdesc:$('<input type="text" />').css("width","100%")},events:{}};$.each(["onblur","onfocus","onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmouseout","onmouseleave","onkeydown","onkeypress","onkeyup"],function(){a.src.events[this]=$('<input type="text" />').css("width","100%")});$.each(a.src,function(){for(var d in this){this[d].attr("name",d)}})};this.command=function(){!this.src&&this.init();this.rte.browser.msie&&this.rte.selection.saveIERange();this.src.main.border.elBorderSelect({change:function(){a.updateImg()},name:"border"});this.src.main.margin.elPaddingInput({type:"margin"});this.cleanValues();this.src.main.src.val("");var j=this.rte.selection.getEnd();this.preview=null;this.prevImg=null;this.link=null;if(j.nodeName=="IMG"){this.img=$(j)}else{this.img=$(this.rte.doc.createElement("img"))}var f={submit:function(s,t){s.stopPropagation();s.preventDefault();a.set();t.close()},dialog:{width:520,position:"top",title:this.rte.i18n("Image")}};var q=new elDialogForm(f);if(this.rte.options.fmAllow&&this.rte.options.fmOpen){var e=$("<span />").append(this.src.main.src.css("width","88%")).append($("<span />").addClass("ui-state-default ui-corner-all").css({"float":"right","margin-right":"3px"}).attr("title",a.rte.i18n("Open file manger")).append($("<span />").addClass("ui-icon ui-icon-folder-open")).click(function(){a.rte.options.fmOpen(function(d){a.src.main.src.val(d).change()})}).hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}))}else{var e=this.src.main.src}q.tab("main",this.rte.i18n("Properies")).append([this.rte.i18n("Image URL"),e],"main",true).append([this.rte.i18n("Title"),this.src.main.title],"main",true).append([this.rte.i18n("Alt text"),this.src.main.alt],"main",true).append([this.rte.i18n("Size"),$("<span />").append(this.src.main.width).append(" x ").append(this.src.main.height).append(" px")],"main",true).append([this.rte.i18n("Alignment"),this.src.main.align],"main",true).append([this.rte.i18n("Margins"),this.src.main.margin],"main",true).append([this.rte.i18n("Border"),this.src.main.border],"main",true);for(var k in this.src){if(k!="main"){q.tab(k,this.rte.i18n(this.labels[k]));for(var g in this.src[k]){var o=this.rte.i18n(this.labels[g]?this.labels[g]:g);if(k=="events"){this.src[k][g].val(this.rte.utils.trimEventCallback(this.img.attr(g)))}else{if(k=="link"){if(this.link){this.src[k][g].val(g=="href"?this.rte.utils.absoluteURL(this.link.attr(g)):this.link.attr(g))}}else{this.src[k][g].val(this.img.attr(g)||"")}}q.append([o,this.src[k][g]],k,true)}}}q.open();var p=$("<fieldset />").append($("<legend />").text(this.rte.i18n("Preview")));q.append(p,"main");var h=document.createElement("iframe");$(h).attr("src","#").addClass("el-rte-preview").appendTo(p);html=this.rte.options.doctype+'<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /></head><body style="padding:0;margin:0;font-size:9px"> </body></html>';h.contentWindow.document.open();h.contentWindow.document.write(html);h.contentWindow.document.close();this.frame=h.contentWindow.document;this.preview=$(h.contentWindow.document.body).text("Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin");if(this.img.attr("src")){this.prevImg=$(this.frame.createElement("img")).attr("src",this.rte.utils.absoluteURL(this.img.attr("src")));this.prevImg.attr("width",this.img.attr("width")).attr("height",this.img.attr("height")).attr("title",this.img.attr("title")||"").attr("alt",this.img.attr("alt")||"").attr("style",this.img.attr("style")||"");for(var j in this.src.adv){var r=this.img.attr(j);if(r){this.prevImg.attr(j,r)}}this.preview.prepend(this.prevImg);this.updateValues()}$.each(this.src,function(){$.each(this,function(){if(this===a.src.main.src){this.bind("change",function(){a.updatePreview()})}else{if(this==a.src.main.width||this==a.src.main.height){this.bind("change",function(d){a.updateDimesions(d)})}else{this.bind("change",function(){a.updateImg()})}}})})};this.updateValues=function(){var d=this.prevImg.get(0);this.origW=this.prevImg.attr("width");this.origH=this.prevImg.attr("height");this.src.main.src.val(this.rte.dom.attr(d,"src"));this.src.main.title.val(this.rte.dom.attr(d,"title"));this.src.main.alt.val(this.rte.dom.attr(d,"alt"));this.src.main.width.val(this.origW);this.src.main.height.val(this.origH);this.src.adv["class"].val(this.rte.dom.attr(d,"class"));this.src.main.margin.val(this.prevImg);var e=this.prevImg.css("float");this.src.main.align.val(e=="left"||e=="right"?e:(this.prevImg.css("vertical-align")||""));this.src.main.border.val(this.prevImg);this.src.adv.style.val(this.rte.dom.attr(d,"style"))};this.cleanValues=function(){$.each(this.src,function(){$.each(this,function(){var d=$(this);if(d.attr("name")!="src"){d.val("")}})})};this.updateImg=function(){this.prevImg.attr({style:$.trim(this.src.adv.style.val()),title:$.trim(this.src.main.title.val()),alt:$.trim(this.src.main.alt.val()),width:parseInt(this.src.main.width.val()),height:parseInt(this.src.main.height.val())});var g=this.src.main.align.val();var h=g=="left"||g=="right"?g:"";var e=this.src.main.border.val();var d=this.src.main.margin.val();this.prevImg.css("float",h);this.prevImg.css("vertical-align",h?"":g);this.prevImg.css("border",$.trim(e.width+" "+e.style+" "+e.color));if(d.css){this.prevImg.css("margin",d.css)}else{this.prevImg.css("margin-top",d.top);this.prevImg.css("margin-right",d.right);this.prevImg.css("margin-bottom",d.bottom);this.prevImg.css("margin-left",d.left)}$.each([this.src.events,this.src.adv],function(){$.each(this,function(){var j=$(this);var k=j.attr("name");if(k!="style"){var f=$.trim(j.val());if(f){a.prevImg.attr(k,f)}else{a.prevImg.removeAttr(k)}}})})};this.updatePreview=function(){var e=this.prevImg?this.prevImg.attr("src"):"";var d=$.trim(this.src.main.src.val());if(!d||d!=e){if(this.prevImg){this.prevImg.remove();this.prevImg=null}this.cleanValues();if(d){this.prevImg=$(this.frame.createElement("img")).attr("src",this.rte.utils.absoluteURL(d)).bind("load",function(){a.updateValues()});this.preview.prepend(this.prevImg);a.updateValues()}}else{this.updateImg()}};this.updateDimesions=function(g){var d=parseInt(this.src.main.width.val())||0;var f=parseInt(this.src.main.height.val())||0;if(d>0&&f>0){if(g.currentTarget==this.src.main.width.get(0)){this.src.main.height.val(parseInt(d*this.origH/this.origW))}else{this.src.main.width.val(parseInt(f*this.origW/this.origH))}}else{this.src.main.width.val(this.origW);this.src.main.height.val(this.origH)}this.updateImg()};this.set=function(){if(!this.prevImg||!this.prevImg.attr("width")){this.img&&this.img.remove();this.link&&this.rte.doc.execCommand("unlink",false,null)}else{if(!this.img.parents().length){this.rte.browser.msie&&this.rte.selection.restoreIERange();this.img=$(this.rte.doc.createElement("img"))}this.img.attr({src:this.rte.utils.absoluteURL($.trim(this.src.main.src.val())),style:$.trim(this.rte.dom.attr(this.prevImg.get(0),"style")),title:$.trim(this.src.main.title.val()),alt:$.trim(this.src.main.alt.val()),width:parseInt(this.src.main.width.val()),height:parseInt(this.src.main.height.val())});for(var d in this.src.adv){if(d!="style"){var e=this.src.adv[d].val();if(e){this.img.attr(d,e)}else{this.img.removeAttr(d)}}}for(var d in this.src.events){var e=this.src.events[d].val();if(e){this.img.attr(d,e)}else{this.img.removeAttr(d)}}if(!this.img.parents().length){this.rte.selection.insertNode(this.img.get(0))}}this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");var d=this.rte.selection.getEnd();if(d.nodeName=="IMG"){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}}};elRTE.prototype.ui.prototype.buttons.indent=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.command=function(){var e=this.rte.selection.selected({collapsed:true,blocks:true,wrap:"inline",tag:"p"});function d(k){var h=/(IMG|HR|TABLE|EMBED|OBJECT)/.test(k.nodeName)?"margin-left":"padding-left";var j=a.rte.dom.attr(k,"style").indexOf(h)!=-1?parseInt($(k).css(h))||0:0;$(k).css(h,j+40+"px")}for(var f=0;f<e.length;f++){if(/^(TABLE|THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(e[f].nodeName)){$(e[f]).find("td,th").each(function(){d(this)})}else{if(/^LI$/.test(e[f].nodeName)){var g=$(e[f]);$(this.rte.dom.create(e[f].parentNode.nodeName)).append($(this.rte.dom.create("li")).html(g.html()||"")).appendTo(g.html("&nbsp;"))}else{d(e[f])}}}this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled")}};elRTE.prototype.ui.prototype.buttons.justifyleft=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){this.constructor.prototype.command.call(this);var c=this.name=="justifyfull"?"justify":this.name.replace("justify","");$(this.rte.doc.body).find("[align]").each(function(){$(this).removeAttr("align").css("text-align",c)});if(this.rte.browser.mozilla){$(this.rte.doc.body).find("div[style]").each(function(){var d=$(this);if(d.attr("style")=="text-align: "+c+";"&&!d.children().length&&$.trim(d.text()).length==0){d.remove()}})}}};elRTE.prototype.ui.prototype.buttons.justifycenter=elRTE.prototype.ui.prototype.buttons.justifyleft;elRTE.prototype.ui.prototype.buttons.justifyright=elRTE.prototype.ui.prototype.buttons.justifyleft;elRTE.prototype.ui.prototype.buttons.justifyfull=elRTE.prototype.ui.prototype.buttons.justifyleft;elRTE.prototype.ui.prototype.buttons.link=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;function d(){a.labels={id:"ID","class":"Css class",style:"Css style",dir:"Script direction",lang:"Language",charset:"Charset",type:"Target MIME type",rel:"Relationship page to target (rel)",rev:"Relationship target to page (rev)",tabindex:"Tab index",accesskey:"Access key"};a.src={main:{href:$('<input type="text" />'),title:$('<input type="text" />'),anchor:$("<select />").attr("name","anchor")},popup:{use:$('<input type="checkbox />"'),url:$('<input type="text" />').val("http://"),name:$('<input type="text" />'),width:$('<input type="text" />').attr({size:6,title:a.rte.i18n("Width")}).css("text-align","right"),height:$('<input type="text" />').attr({size:6,title:a.rte.i18n("Height")}).css("text-align","right"),left:$('<input type="text" />').attr({size:6,title:a.rte.i18n("Left")}).css("text-align","right"),top:$('<input type="text" />').attr({size:6,title:a.rte.i18n("Top")}).css("text-align","right"),location:$('<input type="checkbox" />'),menubar:$('<input type="checkbox" />'),toolbar:$('<input type="checkbox" />'),scrollbars:$('<input type="checkbox" />'),status:$('<input type="checkbox" />'),resizable:$('<input type="checkbox" />'),dependent:$('<input type="checkbox" />'),retfalse:$('<input type="checkbox" />').attr("checked",true)},adv:{id:$('<input type="text" />'),"class":$('<input type="text" />'),style:$('<input type="text" />'),dir:$("<select />").append($("<option />").text(a.rte.i18n("Not set")).val("")).append($("<option />").text(a.rte.i18n("Left to right")).val("ltr")).append($("<option />").text(a.rte.i18n("Right to left")).val("rtl")),lang:$('<input type="text" />'),charset:$('<input type="text" />'),type:$('<input type="text" />'),rel:$('<input type="text" />'),rev:$('<input type="text" />'),tabindex:$('<input type="text" />'),accesskey:$('<input type="text" />')},events:{}};$.each(["onblur","onfocus","onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmouseout","onmouseleave","onkeydown","onkeypress","onkeyup"],function(){a.src.events[this]=$('<input type="text" />')});$.each(a.src,function(){for(var f in this){this[f].attr("name",f);var e=this[f].attr("type");if(!e||(e=="text"&&!this[f].attr("size"))){this[f].css("width","100%")}}})}this.command=function(){!this.src&&d();this.rte.browser.msie&&this.rte.selection.saveIERange();var h=this.rte.selection.getNode();var j;if((j=this.rte.dom.selfOrParentLink(h))){this.link=j}else{if((j=this.rte.dom.childLinks(h))){this.link=j[0]}}this.link=this.link?$(this.link):$(this.rte.doc.createElement("a"));this.updatePopup();this.src.main.anchor.empty();$('a[href!=""][name]',this.rte.doc).each(function(){var r=$(this).attr("name");a.src.main.anchor.append($("<option />").val(r).text(r))});if(this.src.main.anchor.children().length){this.src.main.anchor.prepend($("<option />").val("").text(this.rte.i18n("Select bookmark"))).change(function(){var r=$(this).val();if(r){a.src.main.href.val("#"+r)}})}var e={submit:function(r,s){r.stopPropagation();r.preventDefault();a.set();s.close()},tabs:{show:function(s,r){if(r.index==3){a.updateOnclick()}}},dialog:{width:"auto",width:430,title:this.rte.i18n("Link")}};var k=new elDialogForm(e);var j=$("<div />").append($("<label />").append(this.src.popup.location).append(this.rte.i18n("Location bar"))).append($("<label />").append(this.src.popup.menubar).append(this.rte.i18n("Menu bar"))).append($("<label />").append(this.src.popup.toolbar).append(this.rte.i18n("Toolbar"))).append($("<label />").append(this.src.popup.scrollbars).append(this.rte.i18n("Scrollbars")));var f=$("<div />").append($("<label />").append(this.src.popup.status).append(this.rte.i18n("Status bar"))).append($("<label />").append(this.src.popup.resizable).append(this.rte.i18n("Resizable"))).append($("<label />").append(this.src.popup.dependent).append(this.rte.i18n("Depedent"))).append($("<label />").append(this.src.popup.retfalse).append(this.rte.i18n("Add return false")));k.tab("main",this.rte.i18n("Properies")).tab("popup",this.rte.i18n("Popup")).tab("adv",this.rte.i18n("Advanced")).tab("events",this.rte.i18n("Events")).append($("<label />").append(this.src.popup.use).append(this.rte.i18n("Open link in popup window")),"popup").separator("popup").append([this.rte.i18n("URL"),this.src.popup.url],"popup",true).append([this.rte.i18n("Window name"),this.src.popup.name],"popup",true).append([this.rte.i18n("Window size"),$("<span />").append(this.src.popup.width).append(" x ").append(this.src.popup.height).append(" px")],"popup",true).append([this.rte.i18n("Window position"),$("<span />").append(this.src.popup.left).append(" x ").append(this.src.popup.top).append(" px")],"popup",true).separator("popup").append([j,f],"popup",true);var o=this.link.get(0);var g=this.rte.dom.attr(o,"href");this.src.main.href.val(g).change(function(){$(this).val(a.rte.utils.absoluteURL($(this).val()))});if(this.rte.options.fmAllow&&this.rte.options.fmOpen){var q=$("<span />").append(this.src.main.href.css("width","87%")).append($("<span />").addClass("ui-state-default ui-corner-all").css({"float":"right","margin-right":"3px"}).attr("title",a.rte.i18n("Open file manger")).append($("<span />").addClass("ui-icon ui-icon-folder-open")).click(function(){a.rte.options.fmOpen(function(r){a.src.main.href.val(r).change()})}).hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}));k.append([this.rte.i18n("Link URL"),q],"main",true)}else{k.append([this.rte.i18n("Link URL"),this.src.main.href],"main",true)}this.src.main.href.change();k.append([this.rte.i18n("Title"),this.src.main.title.val(this.rte.dom.attr(o,"title"))],"main",true);if(this.src.main.anchor.children().length){k.append([this.rte.i18n("Bookmark"),this.src.main.anchor.val(g)],"main",true)}for(var h in this.src.adv){this.src.adv[h].val(this.rte.dom.attr(o,h));k.append([this.rte.i18n(this.labels[h]?this.labels[h]:h),this.src.adv[h]],"adv",true)}for(var h in this.src.events){var p=this.rte.utils.trimEventCallback(this.rte.dom.attr(o,h));this.src.events[h].val(p);k.append([this.rte.i18n(this.labels[h]?this.labels[h]:h),this.src.events[h]],"events",true)}this.src.popup.use.change(function(){var r=$(this).attr("checked");$.each(a.src.popup,function(){if($(this).attr("name")!="use"){if(r){$(this).removeAttr("disabled")}else{$(this).attr("disabled",true)}}})});this.src.popup.use.change();k.open()};this.update=function(){var e=this.rte.selection.getNode();if(this.rte.dom.selfOrParentAnchor(e)){this.domElem.addClass("disabled")}else{if(this.rte.dom.selfOrParentLink(e)||this.rte.dom.childLinks(e).length){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.removeClass("active");if(!this.rte.selection.collapsed()||(e.nodeType==1&&/^(IMG|EMBED|OBJECT)$/.test(e.nodeName))){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}};this.updatePopup=function(){var e=this.rte.dom.attr(this.link.get(0),"onclick");e=e?$.trim(e.toString()):"";if(e.length>0&&(m=e.match(/window.open\("([^"]+)",\s*"([^"]*)",\s*"([^"]*)"\s*.*\);\s*(return\s+false)?/))){this.src.popup.use.attr("checked","on");this.src.popup.url.val(m[1]);this.src.popup.name.val(m[2]);if(/location=yes/.test(m[3])){this.src.popup.location.attr("checked",true)}if(/menubar=yes/.test(m[3])){this.src.popup.menubar.attr("checked",true)}if(/toolbar=yes/.test(m[3])){this.src.popup.toolbar.attr("checked",true)}if(/scrollbars=yes/.test(m[3])){this.src.popup.scrollbars.attr("checked",true)}if(/status=yes/.test(m[3])){this.src.popup.status.attr("checked",true)}if(/resizable=yes/.test(m[3])){this.src.popup.resizable.attr("checked",true)}if(/dependent=yes/.test(m[3])){this.src.popup.dependent.attr("checked",true)}if((_m=m[3].match(/width=([^,]+)/))){this.src.popup.width.val(_m[1])}if((_m=m[3].match(/height=([^,]+)/))){this.src.popup.height.val(_m[1])}if((_m=m[3].match(/left=([^,]+)/))){this.src.popup.left.val(_m[1])}if((_m=m[3].match(/top=([^,]+)/))){this.src.popup.top.val(_m[1])}if(m[4]){this.src.popup.retfalse.attr("checked",true)}}else{$.each(this.src.popup,function(){var f=$(this);if(f.attr("type")=="text"){f.val(f.attr("name")=="url"?"http://":"")}else{if(f.attr("name")=="retfalse"){this.attr("checked",true)}else{f.removeAttr("checked")}}})}};this.updateOnclick=function(){var h=this.src.popup.url.val();if(this.src.popup.use.attr("checked")&&h){var j="";if(this.src.popup.location.attr("checked")){j+="location=yes,"}if(this.src.popup.menubar.attr("checked")){j+="menubar=yes,"}if(this.src.popup.toolbar.attr("checked")){j+="toolbar=yes,"}if(this.src.popup.scrollbars.attr("checked")){j+="scrollbars=yes,"}if(this.src.popup.status.attr("checked")){j+="status=yes,"}if(this.src.popup.resizable.attr("checked")){j+="resizable=yes,"}if(this.src.popup.dependent.attr("checked")){j+="dependent=yes,"}if(this.src.popup.width.val()){j+="width="+this.src.popup.width.val()+","}if(this.src.popup.height.val()){j+="height="+this.src.popup.height.val()+","}if(this.src.popup.left.val()){j+="left="+this.src.popup.left.val()+","}if(this.src.popup.top.val()){j+="top="+this.src.popup.top.val()+","}if(j.length>0){j=j.substring(0,j.length-1)}var f=this.src.popup.retfalse.attr("checked")?"return false;":"";var g='window.open("'+h+'", "'+$.trim(this.src.popup.name.val())+'", "'+j+'");'+f;this.src.events.onclick.val(g);if(!this.src.main.href.val()){this.src.main.href.val("#")}}else{var e=this.src.events.onclick.val();e=e.replace(/window\.open\([^\)]+\)\s*;?\s*return\s*false\s*;?/i,"");this.src.events.onclick.val(e)}};this.set=function(){this.updateOnclick();this.rte.browser.msie&&this.rte.selection.restoreIERange();var f=this.rte.utils.absoluteURL(this.src.main.href.val());if(!f){this.link.parents().length&&this.rte.doc.execCommand("unlink",false,null)}else{if(!this.link.parents().length){var g="#--el-editor---"+Math.random();var j=this.rte.doc.execCommand("createLink",false,g);this.link=$('a[href="'+g+'"]',this.rte.doc);this.link.each(function(){var o=$(this);if(!$.trim(o.html())&&!$.trim(o.text())){o.replaceWith(o.text())}})}this.src.main.href.val(f);for(var h in this.src){if(h!="popup"){for(var k in this.src[h]){if(k!="anchors"){var e=$.trim(this.src[h][k].val());if(e){this.link.attr(k,e)}else{this.link.removeAttr(k)}}}}}}this.rte.ui.update(true)}};elRTE.prototype.ui.prototype.buttons.nbsp=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){this.rte.selection.insertHtml("&nbsp;",true);this.rte.window.focus()};this.update=function(){this.domElem.removeClass("disabled")}};elRTE.prototype.ui.prototype.buttons.outdent=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.command=function(){var d=this.find();if(d.node){$(d.node).css(d.type,(d.val>40?d.val-40:0)+"px");this.rte.ui.update()}};this.find=function(f){function d(j){var g={type:"",val:0};var h;if((h=a.rte.dom.attr(j,"style"))){g.type=h.indexOf("padding-left")!=-1?"padding-left":(h.indexOf("margin-left")!=-1?"margin-left":"");g.val=g.type?parseInt($(j).css(g.type))||0:0}return g}var f=this.rte.selection.getNode();var e=d(f);if(e.val){e.node=f}else{$.each(this.rte.dom.parents(f,"*"),function(){e=d(this);if(e.val){e.node=this;return e}})}return e};this.update=function(){var d=this.find();if(d.node){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.pasteformattext=function(c,b){this.constructor.prototype.constructor.call(this,c,b);this.iframe=$(document.createElement("iframe")).addClass("el-rte-paste-input");this.doc=null;var a=this;this.command=function(){this.rte.browser.msie&&this.rte.selection.saveIERange();var f={submit:function(j,k){j.stopPropagation();j.preventDefault();a.paste();k.close()},dialog:{width:500,title:this.rte.i18n("Paste formatted text")}};var h=new elDialogForm(f);h.append(this.iframe).open();this.doc=this.iframe.get(0).contentWindow.document;html=this.rte.options.doctype+'<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';if(this.rte.options.cssfiles.length){$.each(this.rte.options.cssfiles,function(){html+='<link rel="stylesheet" type="text/css" href="'+this+'" />'})}html+="</head><body>  </body></html>";this.doc.open();this.doc.write(html);this.doc.close();if(!this.rte.browser.msie){try{this.doc.designMode="on"}catch(g){}}else{this.doc.body.contentEditable=true}this.iframe.get(0).contentWindow.focus()};this.paste=function(){var d=$.trim($(this.doc.body).html());if(d){this.rte.browser.msie&&this.rte.selection.restoreIERange();this.rte.selection.insertHtml(this.rte.filter(d),true);this.rte.ui.update(true)}};this.update=function(){this.domElem.removeClass("disabled")}};elRTE.prototype.ui.prototype.buttons.pastetext=function(c,b){this.constructor.prototype.constructor.call(this,c,b);this.input=$("<textarea />").addClass("el-rte-paste-input");var a=this;this.command=function(){this.rte.browser.msie&&this.rte.selection.saveIERange();var e={submit:function(g,h){g.stopPropagation();g.preventDefault();a.paste();h.close()},dialog:{width:500,title:this.rte.i18n("Paste only text")}};var f=new elDialogForm(e);f.append(this.input).open()};this.paste=function(){var d=$.trim(this.input.val());if(d){this.rte.browser.msie&&this.rte.selection.restoreIERange();this.rte.selection.insertText(d.replace(/\r?\n/g,"<br />"),true);this.rte.ui.update(true)}this.input.val("")};this.update=function(){this.domElem.removeClass("disabled")}};elRTE.prototype.ui.prototype.buttons.save=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.active=true;this.command=function(){this.rte.save()};this.update=function(){}};elRTE.prototype.ui.prototype.buttons.stopfloat=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.find=function(){if(this.rte.selection.collapsed()){var c=this.rte.dom.selfOrParent(this.rte.selection.getEnd(),/^DIV$/);if(c&&(this.rte.dom.attr(c,"clear")||$(c).css("clear")!="none")){return c}}};this.command=function(){var c;if((c=this.find())){var c=$(c);if(!c.children().length&&!$.trim(c.text()).length){c.remove()}else{c.removeAttr("clear").css("clear","")}}else{this.rte.selection.insertNode($(this.rte.dom.create("div")).css("clear","both").get(0),true)}this.rte.ui.update(true)};this.update=function(){this.domElem.removeClass("disabled");if(this.find()){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}}};elRTE.prototype.ui.prototype.buttons.table=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.src=null;this.labels=null;function d(){a.labels={main:"Properies",adv:"Advanced",events:"Events",id:"ID","class":"Css class",style:"Css style",dir:"Script direction",summary:"Summary",lang:"Language",href:"URL"};a.src={main:{caption:$('<input type="text" />'),rows:$('<input type="text" />').attr("size",5).val(2),cols:$('<input type="text" />').attr("size",5).val(2),width:$('<input type="text" />').attr("size",5),wunit:$("<select />").append($("<option />").val("%").text("%")).append($("<option />").val("px").text("px")),height:$('<input type="text" />').attr("size",5),hunit:$("<select />").append($("<option />").val("%").text("%")).append($("<option />").val("px").text("px")),align:$("<select />").append($("<option />").val("").text(a.rte.i18n("Not set"))).append($("<option />").val("left").text(a.rte.i18n("Left"))).append($("<option />").val("center").text(a.rte.i18n("Center"))).append($("<option />").val("right").text(a.rte.i18n("Right"))),spacing:$('<input type="text" />').attr("size",5),padding:$('<input type="text" />').attr("size",5),border:$("<div />"),rules:$("<select />").append($("<option />").val("none").text(a.rte.i18n("No"))).append($("<option />").val("all").text(a.rte.i18n("Cells"))).append($("<option />").val("groups").text(a.rte.i18n("Groups"))).append($("<option />").val("rows").text(a.rte.i18n("Rows"))).append($("<option />").val("cols").text(a.rte.i18n("Columns"))),margin:$("<div />"),bg:$("<div />"),bgimg:$('<input type="text" />').css("width","90%")},adv:{id:$('<input type="text" />'),summary:$('<input type="text" />'),"class":$('<input type="text" />'),style:$('<input type="text" />'),dir:$("<select />").append($("<option />").text(a.rte.i18n("Not set")).val("")).append($("<option />").text(a.rte.i18n("Left to right")).val("ltr")).append($("<option />").text(a.rte.i18n("Right to left")).val("rtl")),lang:$('<input type="text" />')},events:{}};$.each(a.src,function(){for(var f in this){this[f].attr("name",f);var e=this[f].get(0).nodeName;if(e=="INPUT"&&f!="bgimg"){this[f].css(this[f].attr("size")?{"text-align":"right"}:{width:"100%"})}else{if(e=="SELECT"&&f!="wunit"&&f!="hunit"){this[f].css("width","100%")}}}});$.each(["onblur","onfocus","onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmouseout","onmouseleave","onkeydown","onkeypress","onkeyup"],function(){a.src.events[this]=$('<input type="text" />').attr("name",this).css("width","100%")});a.src.main.align.change(function(){var f=$(this).val();if(f=="center"){a.src.main.margin.val({left:"auto",right:"auto"})}else{var e=a.src.main.margin.val();if(e.left=="auto"&&e.right=="auto"){a.src.main.margin.val({left:"",right:""})}}});a.src.main.bgimg.change(function(){var e=$(this);e.val(a.rte.utils.absoluteURL(e.val()))})}this.command=function(){var p=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TABLE$/);if(this.name=="table"){this.table=$(this.rte.doc.createElement("table"))}else{this.table=p?$(p):$(this.rte.doc.createElement("table"))}!this.src&&d();this.src.main.border.elBorderSelect({styleHeight:117});this.src.main.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"});this.src.main.margin.elPaddingInput({type:"margin",value:this.table});if(this.table.parents().length){this.src.main.rows.val("").attr("disabled",true);this.src.main.cols.val("").attr("disabled",true)}else{this.src.main.rows.val(2).removeAttr("disabled");this.src.main.cols.val(2).removeAttr("disabled")}var A=this.table.css("width")||this.table.attr("width");this.src.main.width.val(parseInt(A)||"");this.src.main.wunit.val(A.indexOf("px")!=-1?"px":"%");var t=this.table.css("height")||this.table.attr("height");this.src.main.height.val(parseInt(t)||"");this.src.main.hunit.val(t&&t.indexOf("px")!=-1?"px":"%");var x=this.table.css("float");this.src.main.align.val("");if(x=="left"||x=="right"){this.src.main.align.val(x)}else{var q=this.table.css("margin-left");var k=this.table.css("margin-right");if(q=="auto"&&k=="auto"){this.src.main.align.val("center")}}this.src.main.border.val(this.table);this.src.main.rules.val(this.rte.dom.attr(this.table.get(0),"rules"));this.src.main.bg.val(this.table.css("background-color"));var e=this.table.css("background-image").replace(/url\(([^\)]+)\)/i,"$1");this.src.main.bgimg.val(e!="none"?e:"");var g={submit:function(f,h){f.stopPropagation();f.preventDefault();a.set();h.close()},dialog:{width:530,title:this.rte.i18n("Table")}};var z=new elDialogForm(g);for(var o in this.src){z.tab(o,this.rte.i18n(this.labels[o]));if(o=="main"){var u=$("<table />").append($("<tr />").append("<td>"+this.rte.i18n("Rows")+"</td>").append($("<td />").append(this.src.main.rows))).append($("<tr />").append("<td>"+this.rte.i18n("Columns")+"</td>").append($("<td />").append(this.src.main.cols)));var s=$("<table />").append($("<tr />").append("<td>"+this.rte.i18n("Width")+"</td>").append($("<td />").append(this.src.main.width).append(this.src.main.wunit))).append($("<tr />").append("<td>"+this.rte.i18n("Height")+"</td>").append($("<td />").append(this.src.main.height).append(this.src.main.hunit)));var r=$("<table />").append($("<tr />").append("<td>"+this.rte.i18n("Spacing")+"</td>").append($("<td />").append(this.src.main.spacing.val(this.table.attr("cellspacing")||"")))).append($("<tr />").append("<td>"+this.rte.i18n("Padding")+"</td>").append($("<td />").append(this.src.main.padding.val(this.table.attr("cellpadding")||""))));z.append([this.rte.i18n("Caption"),this.src.main.caption.val(this.table.find("caption").eq(0).text()||"")],"main",true).separator("main").append([u,s,r],"main",true).separator("main").append([this.rte.i18n("Border"),this.src.main.border],"main",true).append([this.rte.i18n("Inner borders"),this.src.main.rules],"main",true).append([this.rte.i18n("Alignment"),this.src.main.align],"main",true).append([this.rte.i18n("Margins"),this.src.main.margin],"main",true).append([this.rte.i18n("Background"),$("<span />").append($("<span />").css({"float":"left","margin-right":"3px"}).append(this.src.main.bg)).append(this.src.main.bgimg)],"main",true)}else{for(var j in this.src[o]){var B=this.rte.dom.attr(this.table,j);if(o=="events"){B=this.rte.utils.trimEventCallback(B)}z.append([this.rte.i18n(this.labels[j]?this.labels[j]:j),this.src[o][j].val(B)],o,true)}}}z.open()};this.set=function(){if(!this.table.parents().length){var e=parseInt(this.src.main.rows.val())||0;var t=parseInt(this.src.main.cols.val())||0;if(e<=0||t<=0){return}var x=$(this.rte.doc.createElement("tbody")).appendTo(this.table);var u=$("<tr />");for(var o=0;o<t;o++){u.append($("<td />").html("&nbsp;"))}for(var o=0;o<e;o++){x.append(u.clone(true))}this.rte.selection.insertNode(this.table.get(0),true)}else{this.table.removeAttr("width").removeAttr("height").removeAttr("border").removeAttr("align").removeAttr("bordercolor").removeAttr("bgcolor").removeAttr("cellspacing").removeAttr("cellpadding").removeAttr("frame").removeAttr("rules").removeAttr("style")}var D=$.trim(this.src.main.caption.val());if(D){if(!this.table.children("caption").length){this.table.prepend($("<caption />"))}this.table.children("caption").text(D)}else{this.table.children("caption").remove()}for(var j in this.src){if(j!="main"){for(var g in this.src[j]){var B=$.trim(this.src[j][g].val());if(B){this.table.attr(g,B)}else{this.table.removeAttr(g)}}}}var s,z,C;if((s=parseInt(this.src.main.spacing.val()))&&s>=0){this.table.attr("cellspacing",s)}if((z=parseInt(this.src.main.padding.val()))&&z>=0){this.table.attr("cellpadding",z)}if((C=this.src.main.rules.val())){this.table.attr("rules",C)}var A=parseInt(this.src.main.width.val())||"",p=parseInt(this.src.main.height.val())||"",o=$.trim(this.src.main.bgimg.val()),x=this.src.main.border.val(),k=this.src.main.margin.val(),q=this.src.main.align.val();this.table.css({width:A?A+this.src.main.wunit.val():"",height:p?p+this.src.main.hunit.val():"",border:$.trim(x.width+" "+x.style+" "+x.color),"background-color":this.src.main.bg.val(),"background-image":o?"url("+o+")":""});if(k.css){this.table.css("margin",k.css)}else{this.table.css({"margin-top":k.top,"margin-right":k.right,"margin-bottom":k.bottom,"margin-left":k.left})}if((q=="left"||q=="right")&&this.table.css("margin-left")!="auto"&&this.table.css("margin-right")!="auto"){this.table.css("float",q)}if(!this.table.attr("style")){this.table.removeAttr("style")}this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");if(this.name=="tableprops"&&!this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TABLE$/)){this.domElem.addClass("disabled").removeClass("active")}}};elRTE.prototype.ui.prototype.buttons.tableprops=elRTE.prototype.ui.prototype.buttons.table;elRTE.prototype.ui.prototype.buttons.tablerm=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){var c=this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/);c&&$(c).remove();this.rte.ui.update(true)};this.update=function(){if(this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.tbcellprops=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.src=null;this.labels=null;function d(){a.labels={main:"Properies",adv:"Advanced",events:"Events",id:"ID","class":"Css class",style:"Css style",dir:"Script direction",lang:"Language"};a.src={main:{type:$("<select />").css("width","100%").append($("<option />").val("td").text(a.rte.i18n("Data"))).append($("<option />").val("th").text(a.rte.i18n("Header"))),width:$('<input type="text" />').attr("size",4),wunit:$("<select />").append($("<option />").val("%").text("%")).append($("<option />").val("px").text("px")),height:$('<input type="text" />').attr("size",4),hunit:$("<select />").append($("<option />").val("%").text("%")).append($("<option />").val("px").text("px")),align:$("<select />").css("width","100%").append($("<option />").val("").text(a.rte.i18n("Not set"))).append($("<option />").val("left").text(a.rte.i18n("Left"))).append($("<option />").val("center").text(a.rte.i18n("Center"))).append($("<option />").val("right").text(a.rte.i18n("Right"))).append($("<option />").val("justify").text(a.rte.i18n("Justify"))),border:$("<div />"),padding:$("<div />"),bg:$("<div />"),bgimg:$('<input type="text" />').css("width","90%"),apply:$("<select />").css("width","100%").append($("<option />").val("").text(a.rte.i18n("Current cell"))).append($("<option />").val("row").text(a.rte.i18n("All cells in row"))).append($("<option />").val("column").text(a.rte.i18n("All cells in column"))).append($("<option />").val("table").text(a.rte.i18n("All cells in table")))},adv:{id:$('<input type="text" />'),"class":$('<input type="text" />'),style:$('<input type="text" />'),dir:$("<select />").css("width","100%").append($("<option />").text(a.rte.i18n("Not set")).val("")).append($("<option />").text(a.rte.i18n("Left to right")).val("ltr")).append($("<option />").text(a.rte.i18n("Right to left")).val("rtl")),lang:$('<input type="text" />')},events:{}};$.each(a.src,function(){for(var e in this){this[e].attr("name",e);if(this[e].attr("type")=="text"&&!this[e].attr("size")&&e!="bgimg"){this[e].css("width","100%")}}});$.each(["onblur","onfocus","onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmouseout","onmouseleave","onkeydown","onkeypress","onkeyup"],function(){a.src.events[this]=$('<input type="text" />').attr("name",this).css("width","100%")})}this.command=function(){!this.src&&d();this.cell=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);if(!this.cell){return}this.src.main.type.val(this.cell.nodeName.toLowerCase());this.cell=$(this.cell);this.src.main.border.elBorderSelect({styleHeight:117,value:this.cell});this.src.main.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"});this.src.main.padding.elPaddingInput({value:this.cell});var e=this.cell.css("width")||this.cell.attr("width");this.src.main.width.val(parseInt(e)||"");this.src.main.wunit.val(e.indexOf("px")!=-1?"px":"%");var k=this.cell.css("height")||this.cell.attr("height");this.src.main.height.val(parseInt(k)||"");this.src.main.hunit.val(k.indexOf("px")!=-1?"px":"%");this.src.main.align.val(this.cell.attr("align")||this.cell.css("text-align"));this.src.main.bg.val(this.cell.css("background-color"));var p=this.cell.css("background-image");this.src.main.bgimg.val(p&&p!="none"?p.replace(/url\(([^\)]+)\)/i,"$1"):"");this.src.main.apply.val("");var o={submit:function(h,r){h.stopPropagation();h.preventDefault();a.set();r.close()},dialog:{width:"auto",title:this.rte.i18n("Table cell properties")}};var q=new elDialogForm(o);for(var j in this.src){q.tab(j,this.rte.i18n(this.labels[j]));if(j=="main"){q.append([this.rte.i18n("Width"),$("<span />").append(this.src.main.width).append(this.src.main.wunit)],"main",true).append([this.rte.i18n("Height"),$("<span />").append(this.src.main.height).append(this.src.main.hunit)],"main",true).append([this.rte.i18n("Table cell type"),this.src.main.type],"main",true).append([this.rte.i18n("Border"),this.src.main.border],"main",true).append([this.rte.i18n("Alignment"),this.src.main.align],"main",true).append([this.rte.i18n("Paddings"),this.src.main.padding],"main",true).append([this.rte.i18n("Background"),$("<span />").append($("<span />").css({"float":"left","margin-right":"3px"}).append(this.src.main.bg)).append(this.src.main.bgimg)],"main",true).append([this.rte.i18n("Apply to"),this.src.main.apply],"main",true)}else{for(var g in this.src[j]){var f=this.cell.attr(g)||"";if(j=="events"){f=this.rte.utils.trimEventCallback(f)}q.append([this.rte.i18n(this.labels[g]?this.labels[g]:g),this.src[j][g].val(f)],j,true)}}}q.open()};this.set=function(){var q=this.cell;var u=this.src.main.apply.val();switch(this.src.main.apply.val()){case"row":q=this.cell.parent("tr").children("td,th");break;case"column":q=$(this.rte.dom.tableColumn(this.cell.get(0)));break;case"table":q=this.cell.parents("table").find("td,th");break}for(var g in this.src){if(g!="main"){for(var f in this.src[g]){var x=$.trim(this.src[g][f].val());if(x){q.attr(f,x)}else{q.removeAttr(f)}}}}q.removeAttr("width").removeAttr("height").removeAttr("border").removeAttr("align").removeAttr("bordercolor").removeAttr("bgcolor");var z=this.src.main.type.val();var s=parseInt(this.src.main.width.val())||"";var k=parseInt(this.src.main.height.val())||"";var j=$.trim(this.src.main.bgimg.val());var r=this.src.main.border.val();var o={width:s?s+this.src.main.wunit.val():"",height:k?k+this.src.main.hunit.val():"","background-color":this.src.main.bg.val(),"background-image":j?"url("+j+")":"",border:$.trim(r.width+" "+r.style+" "+r.color),"text-align":this.src.main.align.val()||""};var e=this.src.main.padding.val();if(e.css){o.padding=e.css}else{o["padding-top"]=e.top;o["padding-right"]=e.right;o["padding-bottom"]=e.bottom;o["padding-left"]=e.left}q=q.get();$.each(q,function(){var w=this.nodeName.toLowerCase();var B=$(this);if(w!=z){var h={};for(var t in a.src.adv){var p=B.attr(t);if(p){h[t]=p.toString()}}for(var t in a.src.events){var p=B.attr(t);if(p){h[t]=p.toString()}}var C=B.attr("colspan")||1;var A=B.attr("rowspan")||1;if(C>1){h.colspan=C}if(A>1){h.rowspan=A}B.replaceWith($("<"+z+" />").html(B.html()).attr(h).css(o))}else{B.css(o)}});this.rte.ui.update()};this.update=function(){if(this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.tbcellsmerge=function(d,c){this.constructor.prototype.constructor.call(this,d,c);var b=this;function a(){var f=b.rte.dom.selfOrParent(b.rte.selection.getStart(),/^(TD|TH)$/);var e=b.rte.dom.selfOrParent(b.rte.selection.getEnd(),/^(TD|TH)$/);if(f&&e&&f!=e&&$(f).parents("table").get(0)==$(e).parents("table").get(0)){return[f,e]}return null}this.command=function(){var u=a();if(u){var t=this.rte.dom.indexOf($(u[0]).parent("tr").get(0));var o=this.rte.dom.indexOf($(u[1]).parent("tr").get(0));var k=Math.min(t,o);var q=Math.max(t,o)-k+1;var f=this.rte.dom.tableColumn(u[0],true,true);var e=this.rte.dom.tableColumn(u[1],true);var w=$.inArray(u[0],f.column);var s=$.inArray(u[1],e.column);var j=f.info.offset[w]<e.info.offset[s]?f:e;var r=f.info.offset[w]>=e.info.offset[s]?f:e;var g=0;var p=null;var h="";var v=$($(u[0]).parents("table").eq(0).find("tr").get().slice(k,k+q)).each(function(A){var z=h.length;var x=false;$(this).children("td,th").each(function(){var G=$(this);var E=$.inArray(this,j.column);var D=$.inArray(this,r.column);if(E!=-1||D!=-1){x=E!=-1&&D==-1;var C=parseInt(G.attr("colspan")||1);if(A==0){g+=C}if(E!=-1&&A>0){var H=j.info.delta[E];if(H>0){if(G.css("text-align")=="left"){var B=G.clone(true);G.html("&nbsp;")}else{var B=G.clone().html("&nbsp;")}B.removeAttr("colspan").removeAttr("id").insertBefore(this);if(H>1){B.attr("colspan",H)}}}if(D!=-1){var H=r.info.delta[D];if(C-H>1){var F=C-H-1;if(G.css("text-align")=="right"){var B=G.clone(true);G.html("&nbsp;")}else{var B=G.clone().html("&nbsp;")}B.removeAttr("colspan").removeAttr("id").insertAfter(this);if(F>1){B.attr("colspan",F)}}}if(!p){p=G}else{h+=G.html();G.remove()}}else{if(x){if(A==0){g+=parseInt(G.attr("colspan")||1)}h+=G.html();G.remove()}}});h+=z!=h.length?"<br />":""});p.removeAttr("colspan").removeAttr("rowspan").html(p.html()+h);if(g>1){p.attr("colspan",g)}if(q>1){p.attr("rowspan",q)}this.rte.dom.fixTable($(u[0]).parents("table").get(0))}};this.update=function(){if(a()){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.tbcellsplit=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){var f=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);if(f){var g=parseInt(this.rte.dom.attr(f,"colspan"));var h=parseInt(this.rte.dom.attr(f,"rowspan"));if(g>1||h>1){var p=g-1;var q=h-1;var k=this.rte.dom.parent(f,/^TABLE$/);var j=this.rte.dom.tableMatrix(k);if(p){for(var o=0;o<p;o++){$(this.rte.dom.create(f.nodeName)).html("&nbsp;").insertAfter(f)}}if(q){var t=this.rte.dom.indexesOfCell(f,j);var e=t[0];var d=t[1];for(var c=e+1;c<e+q+1;c++){var s;if(!j[c][d].nodeName){if(j[c][d-1].nodeName){s=j[c][d-1]}else{for(var o=d-1;o>=0;o--){if(j[c][o].nodeName){s=j[c][o];break}}}if(s){for(var o=0;o<=p;o++){$(this.rte.dom.create(s.nodeName)).html("&nbsp;").insertAfter(s)}}}}}$(f).removeAttr("colspan").removeAttr("rowspan");this.rte.dom.fixTable(k)}}this.rte.ui.update(true)};this.update=function(){var c=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);if(c&&(parseInt(this.rte.dom.attr(c,"colspan"))>1||parseInt(this.rte.dom.attr(c,"rowspan"))>1)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.tbcolbefore=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.command=function(){var d=this.rte.dom.tableColumn(this.rte.selection.getNode(),false,true);if(d.length){$.each(d,function(){var f=$(this);var e=parseInt(f.attr("colspan")||1);if(e>1){f.attr("colspan",e+1)}else{var g=f.clone().html("&nbsp;").removeAttr("colspan").removeAttr("width").removeAttr("id");if(a.name=="tbcolbefore"){g.insertBefore(this)}else{g.insertAfter(this)}}});this.rte.ui.update()}};this.update=function(){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.tbcolafter=elRTE.prototype.ui.prototype.buttons.tbcolbefore;elRTE.prototype.ui.prototype.buttons.tbcolrm=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.command=function(){var j=this.rte.selection.getNode();var h=this.rte.dom.selfOrParent(j,/^(TD|TH)$/);var g=$(h).prev("td,th").get(0);var f=$(h).next("td,th").get(0);var d=this.rte.dom.parent(j,/^TABLE$/);var e=this.rte.dom.tableColumn(j,false,true);if(e.length){$.each(e,function(){var o=$(this);var k=parseInt(o.attr("colspan")||1);if(k>1){o.attr("colspan",k-1)}else{o.remove()}});this.rte.dom.fixTable(d);if(g||f){this.rte.selection.selectContents(g?g:f).collapse(true)}this.rte.ui.update(true)}};this.update=function(){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.tbrowrm=function(c,b){this.constructor.prototype.constructor.call(this,c,b);var a=this;this.command=function(){var e=this.rte.selection.getNode();var t=this.rte.dom.selfOrParent(e,/^(TD|TH)$/);var d=this.rte.dom.selfOrParent(t,/^TR$/);var k=this.rte.dom.selfOrParent(t,/^TABLE$/);var v=this.rte.dom.tableMatrix(k);if(t&&d&&v.length){if(v.length==1){$(k).remove();return this.rte.ui.update()}var p=[];var q=$(d).prevAll("tr").length;function j(r,z){while(z>0){z--;if(v[z]&&v[z][r]&&v[z][r].nodeName){return v[z][r]}}}function w(z,r){y=q+1;var B=null;if(v[y]){for(var A=0;A<r;A++){if(v[y][A]&&v[y][A].nodeName){B=v[y][A]}}z=z.remove();if(B){z.insertAfter(B)}else{z.prependTo($(d).next("tr").eq(0))}}}function h(x){for(var r=0;r<x.length;r++){if(x[r]==t){return r<x.length-1?x[r+1]:x[r-1]}}}for(var o=0;o<v[q].length;o++){var u=null;var f=false;if(v[q][o]&&v[q][o].nodeName){u=v[q][o];f=true}else{if(v[q][o]=="-"&&(u=j(o,q))){f=false}}if(u){u=$(u);var g=parseInt(u.attr("rowspan")||1);if(g>1){u.attr("rowspan",g-1);f&&w(u,o,q)}}}var s=h(this.rte.dom.tableColumn(t));if(s){this.rte.selection.selectContents(s).collapse(true)}$(d).remove()}this.rte.ui.update()};this.update=function(){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TR$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.unlink=function(b,a){this.constructor.prototype.constructor.call(this,b,a);this.command=function(){var e=this.rte.selection.getNode();var c,d;if((c=this.rte.dom.selfOrParentLink(e))){d=c}else{if((c=this.rte.dom.childLinks(e))){d=c[0]}}if(d){this.rte.selection.select(d);this.rte.doc.execCommand("unlink",false,null);this.rte.ui.update(true)}};this.update=function(){var c=this.rte.selection.getNode();if(this.rte.dom.selfOrParentLink(c)||this.rte.dom.childLinks(c).length){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.removeClass("active").addClass("disabled")}}};